;/T/ Compagnies - Validation de la destruction
;
;/P/ Programmeur..: Alain Côté
;    Date Création: 1 septembre 1993
;
;    Description..: Cet écran vérifie si la compagnie reçu en paramètre est
;                   référée dans une autre table, pour le traitement de la
;                   destruction dans l'écran maitre.
;
;
;-------------------------------------------------------------------------------

;/V/ Écran vérifier pour le passage à l'an 2000


SCREEN mc002x NOMODE &
              ACTION LABEL " " &
              FROM 23,70 TO 23,80 &
              RECEIVING MCCOMPAGNIE , &
                        T_FLGDEL

;-------------------------------------------------------------------------------
;
TEMPORARY T_FLGDEL CHARACTER SIZE 1 ; Flag de retour.


;-------------------------------------------------------------------------------
;
; Compagnie.
;
FILE MCCOMPAGNIE      MASTER

;
; Unité administrative.
;
FILE MCUNITE_ADM      REFERENCE

;
; Compte de banque.
;
FILE MCLIVRET_BQ      REFERENCE

;
; Référence(client,fournisseur, employé).
;
FILE MCREFERENCE      REFERENCE

;
; Lot du Grand Livre.
;
FILE GLLOT            REFERENCE

;
; Format des états financier.
;
FILE GLEF_FORMAT      REFERENCE

;
; Etats financiers.
;
FILE GLETAT_FINANCIER REFERENCE

;
; Cédule d'impressionn des états financiers.
;
FILE GLEF_CEDULE      REFERENCE

;
; Ecriture du journal général.
;
FILE GLECRITURE_JG    REFERENCE

;
; Lot des comptes à payer.
;
FILE CPLOT            REFERENCE

;
; Fournisseur par compagnie.
;
FILE CPFOU_CIE        REFERENCE

;
; Fournisseurs(compagnie d'inter).
;
FILE CPFOURNISSEUR    REFERENCE

;
; Paramètre par compagnie des comptes à payer.
;
FILE CPCIE_PARAM      REFERENCE

;
; Intervalle de dates des comptes à payer.
;
FILE CPINTERVALLE     REFERENCE

;
; Mémos des comptes à payer.
;
FILE CPMEMO           REFERENCE

;
; Lot des comptes à recevoir.
;
FILE CRLOT            REFERENCE

;
; Clients par compagnie.
;
FILE CRCLI_CIE        REFERENCE

;
; Clients(compagnie d'inter).
;
FILE CRCLIENT         REFERENCE

;
; Intervalle de dates des comptes à recevoir.
;
FILE CRINTERVALLE     REFERENCE

;
; Mémos des comptes à recevoir.
;
FILE CRMEMO           REFERENCE

;
; Projets.
;
FILE GPPROJETS        REFERENCE



;-------------------------------------------------------------------------------
;
;
; La procédure suivante valide si la clé est référée, si oui alors
; on indique une erreur à l'usager. Si la clé n'est pas référé dans aucune
; table alors la valeur de retour sera 1.
;
; Note: si le verbe ERROR est activé dans la procédure INITIALIZE, le
;       reste de la procédure ne sera pas effectué.
;
;
PROCEDURE INITIALIZE
BEGIN
  ;
  ; On vérifie dans les unités administratives.
  ;
  GET MCUNITE_ADM VIA   CIECLE &
                  USING CIECLE OF MCCOMPAGNIE &
                  OPTIONAL
  IF ACCESSOK
  THEN ERROR 164 ; Destruction annulée, cette information est référée par une
                 ; unité adm.

  ;
  ; On vérifie dans les comptes de banque.
  ;
  GET MCLIVRET_BQ VIA   CIECLE &
                  USING CIECLE OF MCCOMPAGNIE &
                  OPTIONAL
  IF ACCESSOK
  THEN ERROR 165 ; Destruction annulée, cette information est référée par une
                 ; unité adm.

  ;
  ; On vérifie dans les références(client, fournisseur et employé).
  ;
  GET MCREFERENCE VIA   REFCIECLE &
                  USING CIECLE OF MCCOMPAGNIE &
                  OPTIONAL
  IF ACCESSOK
  THEN ERROR 157 ; Destruction annulée, cette information est référée par une
                 ; référence.

  ;
  ; On vérifie dans les lots du Grand Livre.
  ;
  GET GLLOT VIA   LGLCIECLE &
            USING CIECLE OF MCCOMPAGNIE &
            OPTIONAL
  IF ACCESSOK
  THEN ERROR 169 ; Destruction annulée, cette information est référée par un
                 ; lot.

  ;
  ; On vérifie dans les formats des états financier.
  ;
  GET GLEF_FORMAT VIA   EFFCIECLE &
                  USING CIECLE OF MCCOMPAGNIE &
                  OPTIONAL
  IF ACCESSOK
  THEN ERROR 176 ; Destruction annulée, cette information est référée par un
                 ; format état financier.

  ;
  ; On vérifie dans les états financier.
  ;
  GET GLETAT_FINANCIER VIA   EFICIECLE &
                       USING CIECLE OF MCCOMPAGNIE &
                       OPTIONAL
  IF ACCESSOK
  THEN ERROR 177 ; Destruction annulée, cette information est référée par un
                 ; état financier.

  ;
  ; On vérifie dans les cédules d'impression.
  ;
  GET GLEF_CEDULE VIA   ECECIECLE &
                  USING CIECLE OF MCCOMPAGNIE &
                  OPTIONAL
  IF ACCESSOK
  THEN ERROR 178 ; Destruction annulée, cette information est référée par une
                 ; cédule d'impression.

  ;
  ; On vérifie dans les écritures de journal.
  ;
  GET GLECRITURE_JG VIA   ECJCIECLE &
                    USING CIECLE OF MCCOMPAGNIE &
                    OPTIONAL
  IF ACCESSOK
  THEN ERROR 170 ; Destruction annulée, cette information est référée par une
                 ; écriture de journal.

  ;
  ; On vérifie dans les lots des comptes à payer.
  ;
  GET CPLOT VIA   CIECLE &
            USING CIECLE OF MCCOMPAGNIE &
            OPTIONAL
  IF ACCESSOK
  THEN ERROR 169 ; Destruction annulée, cette information est référée par un
                 ; lot.

  ;
  ; On vérifie dans les fournisseurs par compagnie.
  ;
  GET CPFOU_CIE VIA   FOCCIECLE &
                USING CIECLE OF MCCOMPAGNIE &
                OPTIONAL
  IF ACCESSOK
  THEN ERROR 159 ; Destruction annulée, cette information est référée par un
                 ; fournisseur par compagnie.

  ;
  ; On vérifie dans les fournisseurs selon la compagnie d'inter.
  ;
  GET CPFOURNISSEUR VIA   FOUCIEINT &
                    USING CIECLE OF MCCOMPAGNIE &
                    OPTIONAL
  IF ACCESSOK
  THEN ERROR 179 ; Destruction annulée, cette information est référée par un
                 ; fournisseur.

  ;
  ; On vérifie dans les paramètres pas compagnie des comptes à payer.
  ;
  GET CPCIE_PARAM VIA   CIECLE &
                  USING CIECLE OF MCCOMPAGNIE &
                  OPTIONAL
  IF ACCESSOK
  THEN ERROR 172 ; Destruction annulée, cette information est référée dans
                 ; les paramètres des comptes à payer.

  ;
  ; On vérifie dans les intervalles des comptes à payer.
  ;
  GET CPINTERVALLE VIA   CIECLE &
                   USING CIECLE OF MCCOMPAGNIE &
                   OPTIONAL
  IF ACCESSOK
  THEN ERROR 180 ; Destruction annulée, cette information est référée dans les
                 ; intervalles(cp).

  ;
  ; On vérifie dans les mémos des comptes à payer.
  ;
  GET CPMEMO VIA   CIECLE &
             USING CIECLE OF MCCOMPAGNIE &
             OPTIONAL
  IF ACCESSOK
  THEN ERROR 181 ; Destruction annulée, cette information est référée par un
                 ; mémo des comptes à payer.

  ;
  ; On vérifie dans les lots des comptes à recevoir.
  ;
  GET CRLOT VIA   CIECLE &
            USING CIECLE OF MCCOMPAGNIE &
            OPTIONAL
  IF ACCESSOK
  THEN ERROR 169 ; Destruction annulée, cette information est référée par un
                 ; lot.

  ;
  ; On vérifie dans les clients par compagnie.
  ;
  GET CRCLI_CIE VIA   CIECLE &
                USING CIECLE OF MCCOMPAGNIE &
                OPTIONAL
  IF ACCESSOK
  THEN ERROR 162 ; Destruction annulée, cette information est référée par un
                 ; client-compagnie.

  ;
  ; On vérifie dans les clients, selon la compagnie d'inter du client.
  ;
  GET CRCLIENT VIA   CLICIEINT &
               USING CIECLE OF MCCOMPAGNIE &
               OPTIONAL
  IF ACCESSOK
  THEN ERROR 182 ; Destruction annulée, cette information est référée par un
                 ; client.

  ;
  ; On vérifie dans les intervalles des comptes à recevoir.
  ;
  GET CRINTERVALLE VIA   CIECLE &
                   USING CIECLE OF MCCOMPAGNIE &
                   OPTIONAL
  IF ACCESSOK
  THEN ERROR 183 ; Destruction annulée, cette information est référée dans
                 ; les intervalles(cr).

  ;
  ; On vérifie dans les mémos des comptes à recevoir.
  ;
  GET CRMEMO VIA   CIECLE &
             USING CIECLE OF MCCOMPAGNIE &
             OPTIONAL
  IF ACCESSOK
  THEN ERROR 184 ; Destruction annulée, cette information est référée par un
                 ; mémo des comptes à recevoir.

  ;
  ; On vérifie dans les projets.
  ;
  GET GPPROJETS VIA   CIECLE &
                USING CIECLE OF MCCOMPAGNIE &
                OPTIONAL
  IF ACCESSOK
  THEN ERROR 185 ; Destruction annulée, cette information est référée par un
                 ; projet.

  ;
  ; On indique par la valeur 1, que la clé n'est pas référée.
  ;
  LET T_FLGDEL = "1"
  RETURN
END

BUILD
