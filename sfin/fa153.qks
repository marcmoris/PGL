;/T/ Facturation
;
;/P/ Programmeur..: Steeve Duguay
;    Date Création: 2 mai 1995
;
;    Description..: Permet la saisie des codes de transactions

;/V/ Écran vérifier pour le passage à l'an 2000

;
SCREEN fa153 ACTIONBAR &
             MODE LABEL "" AT 2,80 &
             NOACTION FIELDMARK RETAIN STARTUP &
             HELP POPUP FROM 4,9 TO 20,72 &
             RECEIVING T_CIECLEMNU, &
                       T_CIENOM


USE fa153.hlp NOLIST

USE ussectmp NOLIST     ; Variable pour la sécurité
"FA153"                 ; Nom de l'écran

USE usactecr  NOLIST

USE ustrasse NOLIST

;-------------------------------------------------------------------------------

TEMPORARY T_CIECLEMNU CHARACTER SIZE 04 ; Numéro de la compagnie
TEMPORARY T_CIENOM    CHARACTER SIZE 40 ; Nom de la compagnie

DEFINE    DZ_CIECLE   CHARACTER SIZE 04 = T_CIECLEMNU
DEFINE    DZ_CIENOM   CHARACTER SIZE 40 = CENTER( T_CIENOM )

TEMPORARY T_FGNCLE    CHARACTER SIZE 2 RESET AT MODE
;-------------------------------------------------------------------------------
;
; Table primaire.
;
FILE FACOD_TRANS        PRIMARY &
                        OCCURS 16 &
                        NOITEM
  ACCESS VIA     CIECLE,      &
                 FCTCLE       &
         USING   T_CIECLEMNU, &
                 FCTCLE       &
         REQUEST FCTCLE       &
         ORDERBY FCTCLE

  ACCESS VIA     CIECLE       &
         USING   T_CIECLEMNU  &
         ORDERBY FCTCLE


  ITEM CIECLE OF FACOD_TRANS  INITIAL T_CIECLEMNU

USE usdrwecr NOLIST
USE ustitstd NOLIST
USE ushilite NOLIST

TITLE &
@IF FRANCAIS
      " Code de transaction " &
@ELSE
      " %%%e de transaction " &
@ENDIF
      CENTERED AT 3,1

USE ustitoff NOLIST           ; Pour placer le TITLE OFF

SKIP 1

TITLE &
@IF FRANCAIS
    "Code  Description française         Description anglaise" &
@ELSE
    "Cod   French description            English description " &
@ENDIF
  AT 5,8
SKIP TO 6

ALIGN(8,6,8)(,,13)(,,44)

CLUSTER OCCUR WITH FACOD_TRANS ID BASE 10

FIELD FCTCLE OF FACOD_TRANS     &
      LABEL " " HIDDEN &
      REQUIRED NOCHANGE &
      LOOKUP NOTON FACOD_TRANS &
        VIA   CIECLE, FCTCLE &
        USING T_CIECLEMNU, &
              FCTCLE OF FACOD_TRANS &
        MESSAGE 2742; Ce code de transaction existe déjà

FIELD FCTDSCFRA    OF FACOD_TRANS

FIELD FCTDSCANG    OF FACOD_TRANS &
      DEFAULT FCTDSCFRA OF FACOD_TRANS

CLUSTER

;-------------------------------------------------------------------------------
;
; Validation de l'autorisation d'entrer des données
;
PROCEDURE INPUT FCTCLE
BEGIN
  USE ussecent NOLIST
END

;-------------------------------------------------------------------------------
;
; Valide la sécurité d'accès pour l'écran par son code.
;
;
PROCEDURE INITIALIZE
BEGIN
  USE ussececr NOLIST
END


PROCEDURE PREUPDATE
BEGIN
  FOR FACOD_TRANS
  BEGIN
    ;
    ; Validation de la destruction
    ;
    IF     DELETEDRECORD OF FACOD_TRANS &
       AND TZ_SECDEL = "0"
    THEN ERROR 1
    ;
    ; Validation de la modification.
    ;
    IF     ALTEREDRECORD     OF FACOD_TRANS &
       AND NOT NEWRECORD     OF FACOD_TRANS &
       AND NOT DELETEDRECORD OF FACOD_TRANS &
       AND TZ_SECMOD = "0"
    THEN ERROR 2

  END
END


BUILD LIST DETAIL
@IF FORMAT
xxxx                xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx                   x
***************************** Code de transaction ******************************
*                                                                              *
*      Code  Description française         Description anglaise                *
*      xxxx xxxxxxxxxxxxxxxxxxxxxxxxx      xxxxxxxxxxxxxxxxxxxxxxxxx           *
*      xxxx xxxxxxxxxxxxxxxxxxxxxxxxx      xxxxxxxxxxxxxxxxxxxxxxxxx           *
*      xxxx xxxxxxxxxxxxxxxxxxxxxxxxx      xxxxxxxxxxxxxxxxxxxxxxxxx           *
*      xxxx xxxxxxxxxxxxxxxxxxxxxxxxx      xxxxxxxxxxxxxxxxxxxxxxxxx           *
*      xxxx xxxxxxxxxxxxxxxxxxxxxxxxx      xxxxxxxxxxxxxxxxxxxxxxxxx           *
*      xxxx xxxxxxxxxxxxxxxxxxxxxxxxx      xxxxxxxxxxxxxxxxxxxxxxxxx           *
*      xxxx xxxxxxxxxxxxxxxxxxxxxxxxx      xxxxxxxxxxxxxxxxxxxxxxxxx           *
*      xxxx xxxxxxxxxxxxxxxxxxxxxxxxx      xxxxxxxxxxxxxxxxxxxxxxxxx           *
*      xxxx xxxxxxxxxxxxxxxxxxxxxxxxx      xxxxxxxxxxxxxxxxxxxxxxxxx           *
*      xxxx xxxxxxxxxxxxxxxxxxxxxxxxx      xxxxxxxxxxxxxxxxxxxxxxxxx           *
*      xxxx xxxxxxxxxxxxxxxxxxxxxxxxx      xxxxxxxxxxxxxxxxxxxxxxxxx           *
*      xxxx xxxxxxxxxxxxxxxxxxxxxxxxx      xxxxxxxxxxxxxxxxxxxxxxxxx           *
*      xxxx xxxxxxxxxxxxxxxxxxxxxxxxx      xxxxxxxxxxxxxxxxxxxxxxxxx           *
*      xxxx xxxxxxxxxxxxxxxxxxxxxxxxx      xxxxxxxxxxxxxxxxxxxxxxxxx           *
*      xxxx xxxxxxxxxxxxxxxxxxxxxxxxx      xxxxxxxxxxxxxxxxxxxxxxxxx           *
*      xxxx xxxxxxxxxxxxxxxxxxxxxxxxx      xxxxxxxxxxxxxxxxxxxxxxxxx           *
*                                                                              *
********************************************************************************
@ENDIF
