;/T/ Identification du P/O de transfert (sous-contractant)
;
;
;
;/M/ Programmeur..: Claudie Doyon 1999-06-03
;    Description..: Ajout de la validation qui vérifie si la
;                   ligne de détail existe déjà dans un autre p/o.
;                   Cette validation est placé sur le champs priorité.
;
;/M/ François Déry, 12 mai 1999
;       Ajout du in dict sur la transaction des séquences.
;
;/P/ Programmeur..: René Bonneau
;    Date Création: 1994-10-17
;
;    Description..: Cette écran permet de faire l'identification du P/O de
;                   transfert du bon de commande pour les sous-contractants.
;
;/M/ Programmeur..: Martin Bruyère
;    Date Création: 1995-11-06
;
;/M/ Programmeur..: REMY DEMERS
;    Date Création: 1999-02-12
;
;    DESCRIPTION..: ajout de la procedure ajout pour la mise a jour lors
;                   d'un insert
;-------------------------------------------------------------------------------

SCREEN pd191a ACTIONBAR                      &
              MODE LABEL "" AT 2,80          &
              NOACTION                       &
              FIELDMARK RETAIN STARTUP       &
              HELP POPUP FROM 4,9 TO 20,72   &
              RECEIVING PDBON_COMMANDE,      &
                        T_CIECLEMNU ,        &
                        T_CIENOM

;-------------------------------------------------------------------------------
;
; Déclaration de la transaction pour donner un numéro séquentiel
;

TRANSACTION NO_SEQ READ WRITE &
                   RESERVING FOR PROTECTED WRITE PDSEQ_BON_COMMAN IN DICT


;-------------------------------------------------------------------------------
;
; Débute une transaction pour le sous-écran
;
; Transaction QUERY pour les sous-écrans
;
; Ajout d'une nouvelle transaction QUERY particulière au sous-écran
; pour permettre à l'usager de voir ses modifications
;
USE ustrasse

;-------------------------------------------------------------------------------
;
; Variables pour la sécurité.
;

; Variables temporaire pour la sécurité
;
; Description: Déclaration des variables temporaire pour la gestion
;              de la sécurité-prosig.
;
; Utilisation: Doit être utiliser dans la partie déclaration de l'écran.
;              C'est à dire avant la définition du premier fichier.
;
;------------------------------------------------------------------------------
;
; Accès au programme.
;
TEMPORARY TZ_SECACC CHARACTER SIZE 1 RESET AT STARTUP
;
; Saisie de données(Entry).
;
TEMPORARY TZ_SECENT CHARACTER SIZE 1 RESET AT STARTUP
;
; Destruction.(Delete)
;
TEMPORARY TZ_SECDEL CHARACTER SIZE 1 RESET AT STARTUP
;
; Modification.(Change mode)
;
TEMPORARY TZ_SECMOD CHARACTER SIZE 1 RESET AT STARTUP
;
; Variable pour l'élément de la sécurité.
;
TEMPORARY TZ_XELNOM CHARACTER SIZE 16 RESET AT STARTUP
TEMPORARY TZ_FLGAUT CHARACTER SIZE  1 RESET AT STARTUP
;
; Nom de l'écran pour retrouver la sécurité.
;
TEMPORARY TZ_NOMECR CHARACTER SIZE 7 RESET AT STARTUP INIT &
;
;
;**FIN USSECTMP
    "PD191A"


;-------------------------------------------------------------------------------
;
; Documentation de l'écran.
;
Description of screen &
@IF FRANCAIS
"                                                            " &
"     Cet écran permet la saisie des priorités pour les      " &
" produits semis-finis.                                      " &
"                                                            "
@ELSE
"                                                            " &
"     This screen permits ....                               " &
@ENDIF

;-------------------------------------------------------------------------------
;
; Actionbar standard
;

; ACTIONBAR
;
; Description: Définition du menu déroulant standard situé dans le haut de
;              l'écran.
;
; Utilisation: Il faut l'utiliser dans la partie déclaration de l'écran.
;              C'est à dire avant la déclaration des fichiers.
;
;
;
@IF FRANCAIS
ACTIONMENU LABEL "Rech"   ACTION FIND
ACTIONMENU LABEL "MAJ"    ACTION UPDATE
ACTIONMENU LABEL "Entrée" ACTION ENTRY
ACTIONMENU LABEL "Ajout"  ACTION APPEND
ACTIONMENU LABEL "Select" ACTION SELECT
ACTIONMENU LABEL "Supp"   ACTION DELETE
@ELSE
ACTIONMENU LABEL "Find"   ACTION FIND
ACTIONMENU LABEL "Update" ACTION UPDATE
ACTIONMENU LABEL "Entry"  ACTION ENTRY
ACTIONMENU LABEL "Append" ACTION APPEND
ACTIONMENU LABEL "Select" ACTION SELECT
ACTIONMENU LABEL "Del"    ACTION DELETE
@ENDIF

@IF VAXVMS AND FRANCAIS
ACTIONMENU LABEL "Aide"
  MENUITEM LABEL "Ecran      <PF1 PF2>" ACTION EXTENDED HELP
  MENUITEM LABEL "Champ          <PF2>" ACTION FIELD HELP MARK
  MENUITEM LABEL "Champ dét. <PF1 PF2>" ACTION EXTENDED FIELD HELP MARK
  MENUITEM LABEL "Recherche     <rech>" ACTION FIND
  MENUITEM LABEL "MAJ            <PF3>" ACTION UPDATE
  MENUITEM LABEL "MAJ Retour <PF1 PF3>" ACTION UPDATE RETURN
  MENUITEM LABEL "MAJ Garde      <F19>" ACTION UPDATE STAY
  MENUITEM LABEL "Entrée         <ins>" ACTION ENTRY
  MENUITEM LABEL "Ajout      <PF1 ins>" ACTION APPEND
  MENUITEM LABEL "Sélection   <sélect>" ACTION SELECT
  MENUITEM LABEL "Supp.    <eff.texte>" ACTION DELETE
  MENUITEM LABEL "Supp.Lig  <PF1 eff.>" ACTION DELETE MARK
  MENUITEM LABEL "Edition         <F9>" ACTION FIELDMARK
  MENUITEM LABEL "Bar d'action    <F7>" ACTION ACTIONBAR
  MENUITEM LABEL "Suivant  <page suiv>" ACTION NEXT DATA
  MENUITEM LABEL " //            <F18>" ACTION ACTIONBAR
  MENUITEM LABEL "Ecran préc.    <PF4>" ACTION RETURN
  MENUITEM LABEL "Sortie         <F10>" ACTION ACTIONBAR
  MENUITEM LABEL "Information    <tab>" ACTION INFORMATION
  MENUITEM LABEL "Impression     <F20>" ACTION LIST
  MENUITEM LABEL "Système       <exec>" ACTION SYSTEM
@ENDIF

@IF VAXVMS AND ANGLAIS
ACTIONMENU LABEL "Help"
  MENUITEM LABEL "Screen     <PF1 PF2>" ACTION EXTENDED HELP
  MENUITEM LABEL "Field          <PF2>" ACTION FIELD HELP MARK
  MENUITEM LABEL "Ext. Field <PF1 PF2>" ACTION EXTENDED FIELD HELP MARK
  MENUITEM LABEL "Find Mode     <find>" ACTION FIND
  MENUITEM LABEL "Update         <PF3>" ACTION UPDATE
  MENUITEM LABEL "Update Ret.<PF1 PF3>" ACTION UPDATE RETURN
  MENUITEM LABEL "Update Stay    <F19>" ACTION UPDATE STAY
  MENUITEM LABEL "Entry Mode     <ins>" ACTION ENTRY
  MENUITEM LABEL "Append     <PF1 ins>" ACTION APPEND
  MENUITEM LABEL "Selection   <select>" ACTION SELECT
  MENUITEM LABEL "Delete      <remove>" ACTION DELETE
  MENUITEM LABEL "Del. Line <PF1 rem.>" ACTION DELETE MARK
  MENUITEM LABEL "Field Mark      <F9>" ACTION FIELDMARK
  MENUITEM LABEL "Action Bar      <F7>" ACTION ACTIONBAR
  MENUITEM LABEL "Next     <next page>" ACTION NEXT DATA
  MENUITEM LABEL " //            <F18>" ACTION ACTIONBAR
  MENUITEM LABEL "Prev. Screen   <PF4>" ACTION RETURN
  MENUITEM LABEL "Quick Exit     <F10>" ACTION ACTIONBAR
  MENUITEM LABEL "Information    <tab>" ACTION INFORMATION
  MENUITEM LABEL "List           <F20>" ACTION LIST
  MENUITEM LABEL "System          <Do>" ACTION SYSTEM
@ENDIF

@IF UNIX AND FRANCAIS
ACTIONMENU LABEL "Aide"
  MENUITEM LABEL "Aide            F1_H" ACTION HELP
  MENUITEM LABEL "Aide dét.       F1_?" ACTION EXTENDED HELP
  MENUITEM LABEL "Recherche      F1_F7" ACTION FIND
  MENUITEM LABEL "MAJ               F5" ACTION UPDATE
  MENUITEM LABEL "MAJ Retour     F1_F5" ACTION UPDATE RETURN
  MENUITEM LABEL "MAJ Garde           " ACTION UPDATE STAY
  MENUITEM LABEL "Entrée            F7" ACTION ENTRY
  MENUITEM LABEL "Ajout               " ACTION APPEND
  MENUITEM LABEL "Sélection      F1_F6" ACTION SELECT
  MENUITEM LABEL "Supp.             F2" ACTION DELETE
  MENUITEM LABEL "Supp.Lig            " ACTION DELETE MARK
  MENUITEM LABEL "Edition         F1_M" ACTION FIELDMARK
  MENUITEM LABEL "Bar d'action    F1_B" ACTION ACTIONBAR
  MENUITEM LABEL "Suivant       <Next>" ACTION NEXT DATA
  MENUITEM LABEL " //             F1_A" ACTION ACTIONBAR
  MENUITEM LABEL "Ecran préc.       F8" ACTION RETURN
  MENUITEM LABEL "Sortie         F1_F8" ACTION ACTIONBAR
  MENUITEM LABEL "Information     F1_I" ACTION INFORMATION
  MENUITEM LABEL "Impression écran  F3" ACTION LIST
@ENDIF

@IF UNIX AND ANGLAIS
ACTIONMENU LABEL "Help"
  MENUITEM LABEL "Help            F1_H" ACTION HELP
  MENUITEM LABEL "Ext. Help       F1_?" ACTION EXTENDED HELP
  MENUITEM LABEL "Find mode      F1_F7" ACTION FIND
  MENUITEM LABEL "Update            F5" ACTION UPDATE
  MENUITEM LABEL "Update Return  F1_F5" ACTION UPDATE RETURN
  MENUITEM LABEL "Update Stay         " ACTION UPDATE STAY
  MENUITEM LABEL "Entry Mode        F7" ACTION ENTRY
  MENUITEM LABEL "Append              " ACTION APPEND
  MENUITEM LABEL "Selection      F1_F6" ACTION SELECT
  MENUITEM LABEL "Delete            F2" ACTION DELETE
  MENUITEM LABEL "Del line            " ACTION DELETE MARK
  MENUITEM LABEL "Field Mark      F1_M" ACTION FIELDMARK
  MENUITEM LABEL "Action Bar      F1_B" ACTION ACTIONBAR
  MENUITEM LABEL "Next          <Next>" ACTION NEXT DATA
  MENUITEM LABEL " //             F1_A" ACTION ACTIONBAR
  MENUITEM LABEL "Prev. Screen      F8" ACTION RETURN
  MENUITEM LABEL "Quick Exit     F1_F8" ACTION ACTIONBAR
  MENUITEM LABEL "Information     F1_I" ACTION INFORMATION
  MENUITEM LABEL "List              F3" ACTION LIST
@ENDIF

@IF FRANCAIS
ACTIONMENU LABEL "Sous-écrans"
  MENUITEM LABEL "Copie du diagramme   " ACTION DESIGNER D001
@ELSE
ACTIONMENU LABEL "Subscreen"
  MENUITEM LABEL "%%%Copy du diagramme " ACTION DESIGNER D001
@ENDIF

;
;
;**FIN USACTECR

;-------------------------------------------------------------------------------
;
; Variables saisie ou affichée dans le menu. (et utilisés dans le passage de
; paramètres).
;

TEMPORARY T_CIECLEMNU CHARACTER SIZE 4  RESET AT STARTUP ; Compagnie menu
TEMPORARY T_CIECLE    CHARACTER SIZE 4  RESET AT STARTUP ; Compagnie menu
TEMPORARY T_CIENOM    CHARACTER SIZE 40 RESET AT STARTUP ; nom compagnie
TEMPORARY   X_CIECLE  CHAR SIZE 4
TEMPORARY   X_PJTABR  CHAR SIZE 2
TEMPORARY   X_PJTANN  CHAR SIZE 2
TEMPORARY   X_COMNUMCOMINT   CHAR SIZE 3

TEMPORARY X_DIANUMDIA001 CHAR SIZE 5
TEMPORARY X_DIANUMDIA002 CHAR SIZE 5
TEMPORARY   X_DIAEPA INT SIZE 4
TEMPORARY X_DIAPRIFAC INT SIZE 4
TEMPORARY   X_DIACOM002 CHAR SIZE 76
TEMPORARY   X_DIANUM001   CHAR SIZE 7
TEMPORARY   X_DIANUM002  CHAR SIZE 7
TEMPORARY X_DIAVOLMC3 INT SIZE 4
TEMPORARY X_DIASURMC2 INT SIZE 4
TEMPO X_DIAQTEREMAC INT SIZE 4
TEMPO X_DIAQTEREMSC INT SIZE 4
TEMPO X_DIAQTEFAC INT SIZE 4
TEMPO X_DIAQTERFR INT SIZE 4
TEMPO X_DIAQTEPREGRA INT SIZE 4
;TEMPO X_DIAQTENUMSEQ CHAR SIZE 3
TEMPO X_COMNUMCOM CHAR SIZE 7
TEMPO X_PJTNUMPRO CHAR SIZE 7
TEMPORARY   X_DIAQTEDBT   INT SIZE 4
TEMPO X_DIAQTEPLAFIN INT SIZE 4
TEMPO X_DIAQTEFIN INT SIZE 4


TEMPORARY   X_DCINUMLIG CHAR SIZE 3
TEMPORARY   X_TGRCODGRA    CHAR SIZE 3
TEMPORARY   X_TYFCODFIN    CHAR SIZE 2
TEMPORARY   X_DIANUMPIECLI  CHAR SIZE 15
TEMPORARY   X_DIALON INT SIZE 4
TEMPORARY   X_DIAHAU      INT SIZE 4
TEMPORARY   X_DIAQTECMD      INT SIZE 4
TEMPORARY   X_DIAQTEEMB  INT SIZE 4
TEMPORARY   X_DIAQTEEXPCLI   INT SIZE 4
TEMPORARY   X_DIAQTEREJ    INT SIZE 4
TEMPORARY   X_DIAQTEREM  INT SIZE 4
TEMPORARY   X_DIAFLGPRXPIE  CHAR SIZE 1
TEMPORARY   X_DIAMNTPRXPIE INT SIZE 4
TEMPORARY   X_DIASTU    CHAR SIZE 1
TEMPORARY   X_DIAQTEPLADBTGRA  INT SIZE 4
TEMPORARY   X_DIAQTEPLADBTUSC INT SIZE 4
TEMPORARY   X_DIAQTEPLADBTSCT INT SIZE 4
TEMPORARY   X_DIAQTEDBTGRA   INT SIZE 4
TEMPORARY   X_DIAQTEDBTUSC  INT SIZE 4
TEMPORARY   X_DIAQTEDBTSCT   INT SIZE 4
TEMPORARY   X_DIAQTEPREUSC INT SIZE 4
TEMPORARY   X_DIAQTEEXPUSISCD INT SIZE 4
TEMPORARY   X_DIATYPDIA      CHAR SIZE 1
TEMPORARY   X_DIAQTEPLAFINGRA INT SIZE 4
TEMPORARY   X_DIAQTEPLAFINUSC INT SIZE 4
TEMPORARY   X_DIAQTEPLAFINSCT INT SIZE 4
TEMPORARY   X_DIAQTEFINGRA INT SIZE 4
TEMPORARY   X_DIAQTEFINUSC  INT SIZE 4
TEMPORARY   X_DIAQTEFINSCT    INT SIZE 4
TEMPORARY   X_DIAQTEPRESCT    INT SIZE 4
TEMPORARY   X_DIAQTEEXPSCT  INT SIZE 4
TEMPORARY   X_DIACOM001      CHAR SIZE 76
TEMPORARY  T_2PBCQTECMDDBTSCT INTEGER SIZE 4
TEMPORARY  T_2PBCQTECMDFINSCT INTEGER SIZE 4

;-------------------------------------------------------------------------------
;
; Numéro et nom de la compagnie pour l'en-tête de l'écran.
;

DEFINE DZ_CIECLE CHARACTER SIZE 4 = T_CIECLEMNU
DEFINE DZ_CIENOM CHARACTER SIZE 40 = CENTER( T_CIENOM )

;-------------------------------------------------------------------------------
;
; Bon de commande
;

FILE PDBON_COMMANDE   MASTER

;-------------------------------------------------------------------------------
;
; Produit bon commande
;

FILE PDPROD_BON_CMD PRIMARY &
                    OCCURS 22 TIMES

  ACCESS VIA     CIECLE,           &
                 BCMNUMBCM         &
         USING   T_CIECLEMNU,                          &
                 BCMNUMBCM        OF PDBON_COMMANDE    &
         ORDERBY CIECLE,           &
                 PJTNUMPRO,        &
                 DIANUM002,        &
                 PRICODPRI

  ITEM CIECLE           OF PDPROD_BON_CMD INITIAL T_CIECLEMNU

  ITEM BCMNUMBCM        OF PDPROD_BON_CMD INITIAL &
       BCMNUMBCM        OF PDBON_COMMANDE FIXED

  ITEM PJTABR           OF PDPROD_BON_CMD FINAL   &
       PJTABR           OF PDBON_COMMANDE

  ITEM PJTANN           OF PDPROD_BON_CMD FINAL   &
       PJTANN           OF PDBON_COMMANDE

  ITEM PJTNUMSEQ        OF PDPROD_BON_CMD FINAL   &
       PJTNUMSEQ        OF PDBON_COMMANDE

   ITEM PJTNUMPRO        OF PDPROD_BON_CMD FINAL   &
        PJTNUMPRO        OF PDBON_COMMANDE

TEMPORARY T_PBCQTECMDDBTSCT INT SIZE 4 OCCURS WITH PDPROD_BON_CMD RESET AT STARTUP
TEMPORARY T_PBCQTECMDFINSCT INT SIZE 4 OCCURS WITH PDPROD_BON_CMD RESET AT STARTUP

FILE PDPROD_BON_CMD ALIAS A_PDPROD_BON_CMD DESIGNER
  ACCESS VIA     CIECLE,           &
                 BCMNUMBCM         &
         USING   T_CIECLEMNU,                          &
                 BCMNUMBCM        OF PDBON_COMMANDE

FILE PDPROD_BON_CMD ALIAS X_PDPROD_BON_CMD DESIGNER
  ACCESS VIA     CIECLE,           &
                 BCMNUMBCM         &
         USING   T_CIECLEMNU,                          &
                 BCMNUMBCM        OF PDBON_COMMANDE

;-------------------------------------------------------------------------------
;
; Priorité diagramme
;

FILE PDPRIORITE_DIAG  SECONDARY &
                      NOITEM &
                      OCCURS WITH PDPROD_BON_CMD &
                      NODELETE

  ACCESS VIA     CIECLE,          &
                 DIANUM002,       &
                 PRICODPRI        &
         USING   T_CIECLEMNU,                          &
                 DIANUM002        OF PDPROD_BON_CMD,   &
                 PRICODPRI        OF PDPROD_BON_CMD


  ITEM CIECLE          OF PDPRIORITE_DIAG INITIAL T_CIECLEMNU

FILE PDPRIORITE DESIGNER
FILE PDPRIORITE_DIAG ALIAS A_PDPRIORITE_DIAG DESIGNER OPEN 2
FILE PDPRIORITE_DIAG ALIAS B_PDPRIORITE_DIAG DESIGNER OPEN 3
FILE PDUNI_TRAV_DIA DESIGNER
FILE PDUNI_TRAV_DIA ALIAS A_PDUNI_TRAV_DIA DESIGNER

;-------------------------------------------------------------------------------
;
; Diagramme
;

FILE PDDIAGRAMME      REFERENCE &
                      OCCURS WITH PDPROD_BON_CMD

  ACCESS VIA     CIECLE,          &
                 DIANUM002        &
         USING   T_CIECLEMNU,     &
                 DIANUM002        OF PDPROD_BON_CMD

;-----------------------------------------------------
file pddiagramme alias a_pddiagramme designer

file pddiagramme alias B_pddiagramme designer

file pdcomman_interne designer


FILE PDPROJET REFERENCE

  ACCESS VIA      CIECLE,     &
                  PJTABR      &
         USING    T_CIECLEMNU,&
                  PJTABR          OF PDDIAGRAMME


;----------------------------------------------------------------------------
FILE PDEMBAL_DIAG    REFERENCE &
                      OCCURS WITH PDPROD_BON_CMD

  ACCESS VIA     CIECLE,          &
                 DIANUM002        &
         USING   T_CIECLEMNU,     &
                 DIANUM002        OF PDPROD_BON_CMD
;-------------------------------------------------------------------------------
;
; Détail bon de commande
;

FILE PDDET_BON_COMMAN DESIGNER OCCURS WITH PDPROD_BON_CMD


;-------------------------------------------------------------------------------
;
; Réception
;

FILE PDRECEPTION      DESIGNER &
                      ALIAS PDRECEPTION_VER_DEL &
                      OCCURS WITH PDPROD_BON_CMD

;---------------------------------------------------------------
FILE PDDETAIL_C_I DESIGNER
;-------------------------------------------------------------------------------
;
; Numéro séquentiel pour les bons de commande
;

FILE PDSEQ_BON_COMMAN DESIGNER &
                      TRANSACTION NO_SEQ


;-------------------------------------------------------------------------------
;
; Varialbles nécessaire au traitement
;

TEMPORARY T_SILENT CHARACTER SIZE 01 OCCURS WITH PDPROD_BON_CMD
TEMPORARY T_NEWREC CHARACTER SIZE 01 RESET AT STARTUP
TEMPORARY T_ALTREC CHARACTER SIZE 01 RESET AT STARTUP
TEMPORARY T_TYPCMD CHARACTER SIZE 01 RESET AT STARTUP


;-------------------------------------------------------------------------------
;
; Clés de recherche pour les popup de consultations et les sous écrans
;

TEMPORARY T_DIANUM002      CHARACTER SIZE 07
TEMPORARY T_PRICODPRI      CHARACTER SIZE 02
TEMPORARY T_QTEPLADBT      INTEGER   SIZE 04

TEMPORARY T_PDDNUMLIG      INTEGER   SIZE 02

;-------------------------------------------------------------------------------
;
;

; DRAW des écrans pleine page.
;
; Description: Ce USE sert à dessiner le cadre des écrans pleine page.
;
; Utilisation: Doit être utlisé avant la première énoncée FIELD>
;
;
DRAW 3,01 TO 23,80
;
;
;**FIN USDRWECR
; En-tête standard des écrans pleine page.
;
; Description: Ce USE sert à afficher l'en-tête standard des écrans pleine
;              page.
;
; Utilisation: Doit être utlisé avant la première énoncée FIELD.
;
;
SKIP TO LINE 2

@IF VAXVMS
HILITE DISPLAY HALFTONE
@ENDIF

ALIGN(,,1) (,,21)

FIELD DZ_CIECLE FIXED
FIELD DZ_CIENOM FIXED

;
;
;**FIN USTITSTD
; HILITE standard de tous les écrans
;
; Description: Définition du HILITE standard de tous les écrans, menu
;              écrans pleine page, popup...
;
; Utilisation: Doit être utilisé avant la première énoncé FIELD.
;
;
@IF VAXVMS
HILITE ACTIONBAR     INVERSE                     , &
       ACTIONBARMARK HALFTONE INVERSE            , &
       FIELDMARK     INVERSE                     , &
       MENUMARK      HALFTONE INVERSE            , &
       MODE          HALFTONE                    , &
       TITLE         HALFTONE                    , &
       DISPLAY       HALFTONE UNDERLINE          , &
       INFORMATION   INVERSE                     , &
       WARNING       INVERSE HALFTONE AUDIBLE    , &
       ERROR         INVERSE HALFTONE AUDIBLE    , &
       SEVERE        INVERSE HALFTONE AUDIBLE BLINKING
@ELSE
HILITE ACTIONBAR     HALFTONE INVERSE            , &
       ACTIONBARMARK INVERSE                     , &
       FIELDMARK     INVERSE HALFTONE            , &
       MENUMARK      INVERSE HALFTONE            , &
       MODE          HALFTONE                    , &
       LABEL         HALFTONE                    , &
       LINEDRAWING   HALFTONE                    , &
       TITLE         HALFTONE                    , &
       DISPLAY       UNDERLINE                   , &
       INFORMATION   INVERSE                     , &
       WARNING       INVERSE AUDIBLE             , &
       ERROR         INVERSE AUDIBLE             , &
       SEVERE        INVERSE AUDIBLE BLINKING
@ENDIF
;
;**FIN USHILITE


SKIP

TITLE &
@IF FRANCAIS
      "Détal du P/O sous-contractant" &
@ELSE
      "%%%détail du P/O sous-cont" &
@ENDIF
      CENTERED AT ,1


SKIP TO LINE 5

ALIGN (,3,19) (,31,47) (,54,70)


FIELD BCMNUMBCM        OF PDBON_COMMANDE   &
        DISPLAY                            &
        FIXED


FIELD FOUCLE           OF PDBON_COMMANDE   &
        DISPLAY                            &
        FIXED


FIELD PJTNUMPRO        OF PDBON_COMMANDE   &
        DISPLAY                            &
        FIXED

SKIP TO LINE 7

DRAW 7,2 TO 7,78

TITLE &
@IF FRANCAIS
      " Détail des produits semis-finis " &
@ELSE
      "%%%Détail des produits semis-finis " &
@ENDIF
      CENTERED AT ,1


SKIP TO LINE 9


; HILITE TITLE OFF
;
; Description: Sert à désactiver l'option HILITE pour toutes les
;              énoncés TITLE qui suit ce USE. Seul le titre principal
;              a un HILITE particulier.
;
; Utilisation: Doit être utilisé après le titre principal de l'écran.
;
;
HILITE TITLE OFF
;
;
;**FIN USHILITE


TITLE &
@IF FRANCAIS
      "            * Débit. -* * Finit. -*                * Débit. -* * Finit. -* " &
@ELSE
      "%%%         * Débit. -* * Finit. -*                * Débit. -* * Finit. -* " &
@ENDIF
      AT ,2


SKIP


TITLE &
@IF FRANCAIS
      " Diagr.  Pr   Cmd   Rcu   Cmd   Rcu     Diagr.  Pr   Cmd   Rcu   Cmd   Rcu" &
@ELSE
      "%%%agr.  Pr   Cmd   Rcu   Cmd   Rcu     Diagr.  Pr   Cmd   Rcu   Cmd   Rcu" &
@ENDIF
      AT ,2


SKIP


DRAW 08,40 TO 22,40


ALIGN (02,02,03) (,,11) (,,14) (,,20) (,,26) (,,32)


CLUSTER VERTICAL OCCURS WITH PDPROD_BON_CMD FOR 1,39


FIELD DIANUM002        OF PDPROD_BON_CMD   &
        HIDDEN                             &
        LABEL " "                          &
        REQUIRED                           &
        NOCHANGE                           &
        LOOKUP ON PDDIAGRAMME              &
          VIA     CIECLE,                  &
                  DIANUM002                &
          USING   T_CIECLEMNU,                        &
                  DIANUM002        OF PDPROD_BON_CMD  &
          MESSAGE 2998, & ; Ce numéro de diagramme n'existe pas
               NOTON PDPROD_BON_CMD        &
          VIA   CIECLE,                    &
                BCMNUMBCM,                 &
                DIANUM002,                 &
                PRICODPRI                  &
          USING T_CIECLEMNU,                 &
                BCMNUMBCM OF PDBON_COMMANDE, &
                DIANUM002 OF PDPROD_BON_CMD, &
                PRICODPRI OF PDPROD_BON_CMD  &
          MESSAGE 3218 ; Cette ligne de détail existe déjà



FIELD PRICODPRI        OF PDPROD_BON_CMD   &
        HIDDEN ID SAME                     &
        REQUIRED                           &
        NOCHANGE                           &
        NUMERIC                            &
        LOOKUP ON PDPRIORITE_DIAG          &
          MESSAGE 3006, & ; Cette priorité pour ce diagramme n'existe pas
               NOTON PDPROD_BON_CMD        &
          VIA   CIECLE,                    &
                BCMNUMBCM,                 &
                DIANUM002,                 &
                PRICODPRI                  &
          USING T_CIECLEMNU,                 &
                BCMNUMBCM OF PDBON_COMMANDE, &
                DIANUM002 OF PDPROD_BON_CMD, &
                PRICODPRI OF PDPROD_BON_CMD  &
          MESSAGE 3218 ; , & ; Cette ligne de détail existe déjà

; A la demande du client : Nathalie Desrochers (le 2001/12/11)

;         NOTON PDPROD_BON_CMD &
;            VIA   CIECLE, &
;                  DIANUM002, &
;                  PRICODPRI &
;            USING T_CIECLEMNU, &
;                  DIANUM002 OF PDPROD_BON_CMD, &
;                  PRICODPRI OF PDPROD_BON_CMD &
;            MESSAGE  "Cette ligne de détail existe déjà dans un autre P/O"


FIELD PBCQTECMDDBTSCT  OF PDPROD_BON_CMD   &
      HIDDEN ID SAME                       &
      REQUIRED SIZE 6


FIELD PBCQTERCUDBTSCT  OF PDPROD_BON_CMD   &
      HIDDEN ID SAME                       &
      DISPLAY SIZE 6


FIELD PBCQTECMDFINSCT  OF PDPROD_BON_CMD   &
      HIDDEN ID SAME                       &
      REQUIRED SIZE 6

FIELD PBCQTERCUFINSCT  OF PDPROD_BON_CMD   &
      HIDDEN ID SAME                       &
      DISPLAY SIZE 6


CLUSTER


;-------------------------------------------------------------------------------
;
; Valide la sécurité d'accès de l'écran.
;

PROCEDURE INITIALIZE
BEGIN
; Appel de l'écran de sécurité.
;
; Description: Appel de l'écran de sécurité du module Gestion de système.
;              Les variables temporaires utilisées proviennent du USEFILE
;              USSECTMP.
;
; Utilisation: Doit être inséré dans la procédure INITIALIZE de l'écran.
;
;
RUN SCREEN gs000 PASSING TZ_NOMECR, & ; Nom de l'écran
                         TZ_SECACC, & ; Accès
                         TZ_SECENT, & ; Entrée
                         TZ_SECMOD, & ; Modification
                         TZ_SECDEL    ; Destruction

IF "3" = TZ_SECACC
THEN ERROR 6 ; L'usager n'est pas défini au système.

IF "2" = TZ_SECACC
THEN ERROR 7 ; Votre accès au système est expiré.

IF "0" = TZ_SECACC
THEN ERROR 8 ; Vous n'avez pas accès à cet option.
;
;
;**FIN USSECECR
END


;-------------------------------------------------------------------------------
;
; Appel du dépisteur pour le champ
;

PROCEDURE INPUT DIANUM002
BEGIN
  ;
  ; Appel du dépisteur
  ;
  IF 0 <> INDEX(FIELDTEXT,"*")
  THEN BEGIN
    LET T_DIANUM002 = FIELDTEXT[1:INDEX(FIELDTEXT,"*") - 1] + "@"
    RUN SCREEN pd126 MODE F &
                     PASSING T_DIANUM002, &
                             T_CIECLEMNU
    LET FIELDTEXT = TRUNCATE( T_DIANUM002 )
  END
  ;
  ; Ajout du code de projet si l'utilisateur ne l'a pas saisit
  ;
  IF 5 = SIZE(TRUNCATE(FIELDTEXT)) &
     AND &
     7 <> SIZE(TRUNCATE(DIANUM002 OF PDPROD_BON_CMD))
  THEN BEGIN
    LET FIELDTEXT = PJTABR OF PDBON_COMMANDE + FIELDTEXT
  END
  IF FIELDTEXT[1:2] <> PJTABR OF PDBON_COMMANDE
  THEN ERROR &
"Les deux premiers caracteres doient etre equivalent a ceux de la commande !"
END


;-------------------------------------------------------------------------------
;
;
;

PROCEDURE PROCESS DIANUM002
BEGIN
  LET PJTABR       OF PDPROD_BON_CMD = DIANUM002 OF PDPROD_BON_CMD[1:2]
  LET DIANUMDIA002 OF PDPROD_BON_CMD = DIANUM002 OF PDPROD_BON_CMD[3:5]
END


;-------------------------------------------------------------------------------
;
; Appel du dépisteur (pop-up) pour les priorités
;

PROCEDURE INPUT PRICODPRI
BEGIN

  IF 0 <> INDEX(FIELDTEXT,"*")
  THEN BEGIN
    LET T_DIANUM002    = DIANUM002 OF PDPROD_BON_CMD
    LET T_PRICODPRI = FIELDTEXT[1:INDEX(FIELDTEXT,"*") - 1] + "@"
    RUN SCREEN pd123 MODE F                  &
                     PASSING T_DIANUM002,    &
                             T_PRICODPRI,    &
                             T_QTEPLADBT,    &
                             T_CIECLEMNU
    LET FIELDTEXT = TRUNCATE( T_PRICODPRI )
  END

END


;-------------------------------------------------------------------------------
;
; Appel du dépisteur pour le champ
;

PROCEDURE INPUT PBCQTECMDDBTSCT
BEGIN
  IF 0 <> INDEX(FIELDTEXT,"*")
  THEN BEGIN
    LET T_DIANUM002    = DIANUM002 OF PDPROD_BON_CMD
    LET T_PRICODPRI    = PRICODPRI OF PDPROD_BON_CMD
    RUN SCREEN pd123 MODE F                  &
                     PASSING T_DIANUM002,    &
                             T_PRICODPRI,    &
                             T_QTEPLADBT,    &
                             T_CIECLEMNU
    LET FIELDTEXT = TRUNCATE( ASCII( T_QTEPLADBT ))
  END
END


;-------------------------------------------------------------------------------
;
; Valide que la qte planifier pour la priorité est suffisante pour la qte cmd
;
;ICI TEST
PROCEDURE EDIT PBCQTECMDDBTSCT
BEGIN
  IF FIELDVALUE > (PDGQTEPLACPEGRA OF PDPRIORITE_DIAG + T_PBCQTECMDDBTSCT)
  THEN BEGIN
    ERROR 3168 ; La quantité commandé est inférieur à la quantité pour la priorité
  END
;
;
;  IF FIELDVALUE > (PDGQTEPLACPEGRA OF PDPRIORITE_DIAG - EMDQTEPRD OF PDEMBAL_DIAG)
;  THEN BEGIN
;    ERROR = "La quantité est supérieur a la quantité restante"
;  END



;  IF FIELDVALUE < PBCQTERCUDBTSCT  OF PDPROD_BON_CMD
;  THEN BEGIN
;    ERROR 3220 ; La quantité reçue est plus grande que la quantité commandée
;  END
END


;-------------------------------------------------------------------------------
;
; Valide que la qte planifier pour la priorité est suffisante pour la qte cmd
;
PROCEDURE EDIT PBCQTECMDFINSCT
BEGIN
  IF FIELDVALUE > (PDGQTEPLAFINGRA OF PDPRIORITE_DIAG + T_PBCQTECMDFINSCT)
  THEN BEGIN
    ERROR 3168 ; La quantité commandé est inférieur à la quantité pour la priorité
  END
;  IF FIELDVALUE < PBCQTERCUFINSCT  OF PDPROD_BON_CMD
;  THEN BEGIN
;    ERROR 3220 ; La quantité reçue est plus grande que la quantité commandée
;  END
END


;-------------------------------------------------------------------------------
;
; Valide si l'usager peut faire de la saisie.
;

PROCEDURE PREENTRY
BEGIN
; Sécurité pour le mode ENTRY.
;
; Description: Valide si l'usager peut faire de la saisie dans cette
;              écran.
;
; Utilisation: Peut être utiliser dans la procédure INPUT du premier
;              champ saisie à l'écran, ou dans la procédure ENTRY
;              si celle-ci a été altérée.
;
;
IF     ENTRYMODE       &
   AND TZ_SECENT = "0"
THEN SEVERE 16 ; Vous ne pouvez pas saisir de données.
;
;
;**FIN USSECENT
END



;--------------------------------------------------------------------
PROCEDURE INTERNAL AJOUT
BEGIN
    LET T_PDDNUMLIG = 0

    WHILE RETRIEVING PDDET_BON_COMMAN          &
      VIA   CIECLE,                            &
            BCMNUMBCM                          &
      USING T_CIECLEMNU,                       &
            BCMNUMBCM        OF PDBON_COMMANDE ORDERBY PODNUMLIG
    BEGIN
      LET   T_PDDNUMLIG      = PODNUMLIG        OF PDDET_BON_COMMAN
    END

      LET T_PDDNUMLIG = T_PDDNUMLIG + 1
      LET CIECLE           OF PDDET_BON_COMMAN = T_CIECLEMNU
      LET BCMNUMBCM        OF PDDET_BON_COMMAN = BCMNUMBCM        OF PDBON_COMMANDE
      LET PODNUMLIG        OF PDDET_BON_COMMAN = T_PDDNUMLIG
      LET TPDTYPPRD        OF PDDET_BON_COMMAN = "DI" ; Diagramme
      LET TGRCODGRA        OF PDDET_BON_COMMAN = TGRCODGRA        OF PDDIAGRAMME
      LET TYFCODFIN        OF PDDET_BON_COMMAN = TYFCODFIN        OF PDDIAGRAMME
      LET PODLON           OF PDDET_BON_COMMAN = DIALON           OF PDDIAGRAMME
      LET PODHAU           OF PDDET_BON_COMMAN = DIAHAU           OF PDDIAGRAMME
      LET PODEPA           OF PDDET_BON_COMMAN = DIAEPA           OF PDDIAGRAMME
      LET DIANUMDIA002     OF PDDET_BON_COMMAN = DIANUMDIA002     OF PDPROD_BON_CMD
      LET PODRCU           OF PDDET_BON_COMMAN = "0"        ; Signifie que non
      LET PODCPL           OF PDDET_BON_COMMAN = "0"        ; Signifie que non
      LET PODTYPFINPRD     OF PDDET_BON_COMMAN = T_TYPCMD   ; Semis-finis, Fini, Mixte
      LET PODSURDBTCMD OF PDBON_COMMANDE = PODSURDBTCMD OF PDBON_COMMANDE + &
                                               (DIASURMC2        OF PDDIAGRAMME * &
                                                   PBCQTECMDDBTSCT  OF PDPROD_BON_CMD)

      LET PODSURFINCMD OF PDBON_COMMANDE = PODSURFINCMD OF PDBON_COMMANDE + &
                                               (DIASURMC2        OF PDDIAGRAMME * &
                                                   PBCQTECMDFINSCT  OF PDPROD_BON_CMD)

      IF PBCQTECMDDBTSCT  OF PDPROD_BON_CMD  > PBCQTECMDFINSCT  OF PDPROD_BON_CMD
      THEN BEGIN
        LET PODQTECMD        OF PDDET_BON_COMMAN = PBCQTECMDDBTSCT  OF PDPROD_BON_CMD
        LET PODSURCMD        OF PDDET_BON_COMMAN = DIASURMC2        OF PDDIAGRAMME * &
                                                   PBCQTECMDDBTSCT  OF PDPROD_BON_CMD
        LET PODVOLCMD        OF PDDET_BON_COMMAN = DIAVOLMC3        OF PDDIAGRAMME * &
                                                   PBCQTECMDDBTSCT  OF PDPROD_BON_CMD
      END
      ELSE BEGIN
        LET PODQTECMD        OF PDDET_BON_COMMAN = PBCQTECMDFINSCT  OF PDPROD_BON_CMD
        LET PODSURCMD        OF PDDET_BON_COMMAN = DIASURMC2        OF PDDIAGRAMME * &
                                                   PBCQTECMDFINSCT  OF PDPROD_BON_CMD
        LET PODVOLCMD        OF PDDET_BON_COMMAN = DIAVOLMC3        OF PDDIAGRAMME * &
                                                   PBCQTECMDFINSCT  OF PDPROD_BON_CMD
      END
      LET PODQTERCU        OF PDDET_BON_COMMAN = 0

      LET PODVOLRCU        OF PDDET_BON_COMMAN = 0.00

      LET DIANUM002        OF PDDET_BON_COMMAN = DIANUM002        OF PDPROD_BON_CMD
      LET PJTABR           OF PDDET_BON_COMMAN = DIANUM002        OF PDPROD_BON_CMD[1:2]
      LET DIANUMDIA002     OF PDDET_BON_COMMAN = DIANUM002        OF PDPROD_BON_CMD[3:5]
      LET PRICODPRI        OF PDDET_BON_COMMAN = PRICODPRI        OF PDPROD_BON_CMD
      PUT PDDET_BON_COMMAN RESET


      LET PDGQTEPLACPEGRA OF PDPRIORITE_DIAG = PDGQTEPLACPEGRA OF PDPRIORITE_DIAG - PBCQTECMDDBTSCT OF PDPROD_BON_CMD
      LET PDGQTEPLAFINGRA OF PDPRIORITE_DIAG = PDGQTEPLAFINGRA OF PDPRIORITE_DIAG - PBCQTECMDFINSCT OF PDPROD_BON_CMD
      LET PDGQTEPLACPESCT OF PDPRIORITE_DIAG = PDGQTEPLACPESCT OF PDPRIORITE_DIAG + PBCQTECMDDBTSCT OF PDPROD_BON_CMD
      LET PDGQTEPLAFINSCT OF PDPRIORITE_DIAG = PDGQTEPLAFINSCT OF PDPRIORITE_DIAG + PBCQTECMDFINSCT OF PDPROD_BON_CMD
END


;-------------------------------------------------------------------------------
;
; Valide les traitements permis par écran et par usager.
;

PROCEDURE PREUPDATE
BEGIN

  FOR PDPROD_BON_CMD
  BEGIN

    ;
    ; Validation de la destruction
    ;
    IF     DELETEDRECORD OF PDPROD_BON_CMD &
       AND TZ_SECDEL = "0"
    THEN ERROR 1

    ;
    ; Validation de la modification.
    ;
    IF     ALTEREDRECORD     OF PDPROD_BON_CMD &
       AND NOT NEWRECORD     OF PDPROD_BON_CMD &
       AND NOT DELETEDRECORD OF PDPROD_BON_CMD &
       AND TZ_SECMOD = "0"
    THEN ERROR 2

    ;
    ; Initialisation du timbre de mise à jour
    ;
    IF (NOT NEWRECORD OF PDPROD_BON_CMD &
        AND &
        ALTEREDRECORD OF PDPROD_BON_CMD) &
       OR &
       (NEWRECORD OF PDPROD_BON_CMD &
        AND &
        BCMNUMBCM        OF PDBON_COMMANDE <> 0) &
       OR &
        DELETEDRECORD OF PDPROD_BON_CMD
    THEN BEGIN
      LET BCMDATMAJ        OF PDBON_COMMANDE = SYSDATE
      LET BCMHREMAJ        OF PDBON_COMMANDE = SYSTIME / 10000
      LET BCMUSRMAJ        OF PDBON_COMMANDE = LOGONID
    END
;  END
;23031999
  IF DELETEDRECORD OF PDPROD_BON_CMD
   THEN BEGIN
      LET PDGQTEPLACPEGRA OF PDPRIORITE_DIAG = PDGQTEPLACPEGRA OF PDPRIORITE_DIAG + PBCQTECMDDBTSCT OF PDPROD_BON_CMD
      LET PDGQTEPLAFINGRA OF PDPRIORITE_DIAG = PDGQTEPLAFINGRA OF PDPRIORITE_DIAG + PBCQTECMDFINSCT OF PDPROD_BON_CMD
      LET PDGQTEPLACPESCT OF PDPRIORITE_DIAG = PDGQTEPLACPESCT OF PDPRIORITE_DIAG - PBCQTECMDDBTSCT OF PDPROD_BON_CMD
      LET PDGQTEPLAFINSCT OF PDPRIORITE_DIAG = PDGQTEPLAFINSCT OF PDPRIORITE_DIAG - PBCQTECMDFINSCT OF PDPROD_BON_CMD
   PUT PDPRIORITE_DIAG RESET
  END
 END
  ;-----------------------------------------------------------------------------
  ;
  ; Incrémentation du numéro de séquence
  ;
  IF 0 = BCMNUMBCM OF PDBON_COMMANDE
  THEN BEGIN
    START TRANSACTION NO_SEQ
    GET PDSEQ_BON_COMMAN OPTIONAL       &
      VIA     CIECLE                    &
      USING   T_CIECLEMNU
    IF NOT ACCESSOK
    THEN BEGIN
      LET CIECLE    OF PDSEQ_BON_COMMAN = T_CIECLEMNU
    END
    LET BCQNUM    OF PDSEQ_BON_COMMAN = BCQNUM OF PDSEQ_BON_COMMAN + 1
    LET BCMNUMBCM OF PDBON_COMMANDE   = BCQNUM OF PDSEQ_BON_COMMAN
    PUT PDSEQ_BON_COMMAN
    DISPLAY BCMNUMBCM OF PDBON_COMMANDE
  END

  LET T_NEWREC = "0"
  LET T_ALTREC = "0"
  LET T_TYPCMD = " "

  FOR PDPROD_BON_CMD
  BEGIN
    IF NEWRECORD OF PDPROD_BON_CMD
    THEN BEGIN
      LET T_NEWREC = "1"
;--
DO INTERNAL AJOUT

;--
    END
    IF ALTEREDRECORD OF PDPROD_BON_CMD &
       AND &
       NOT NEWRECORD OF PDPROD_BON_CMD &
       AND &
       NOT DELETEDRECORD OF PDPROD_BON_CMD
    THEN BEGIN
      LET T_ALTREC = "1"
      LET PDGQTEPLACPEGRA OF PDPRIORITE_DIAG = PDGQTEPLACPEGRA OF PDPRIORITE_DIAG - (PBCQTECMDDBTSCT OF PDPROD_BON_CMD - &
                                               T_PBCQTECMDDBTSCT)
      LET PDGQTEPLAFINGRA OF PDPRIORITE_DIAG = PDGQTEPLAFINGRA OF PDPRIORITE_DIAG - (PBCQTECMDFINSCT OF PDPROD_BON_CMD - &
                                               T_PBCQTECMDFINSCT)
      LET PDGQTEPLACPESCT OF PDPRIORITE_DIAG = PDGQTEPLACPESCT OF PDPRIORITE_DIAG + (PBCQTECMDDBTSCT OF PDPROD_BON_CMD - &
                                               T_PBCQTECMDDBTSCT)
      LET PDGQTEPLAFINSCT OF PDPRIORITE_DIAG = PDGQTEPLAFINSCT OF PDPRIORITE_DIAG + (PBCQTECMDFINSCT OF PDPROD_BON_CMD - &
                                               T_PBCQTECMDFINSCT)
   END

    IF NOT DELETEDRECORD OF PDPROD_BON_CMD
    THEN BEGIN
      IF T_TYPCMD = " "
      THEN BEGIN
        IF PBCQTECMDFINSCT OF PDPROD_BON_CMD = 0 &
           AND &
           PBCQTERCUFINSCT OF PDPROD_BON_CMD = 0
        THEN BEGIN
          LET T_TYPCMD = "S"
        END
        ELSE BEGIN
          LET T_TYPCMD = "F"
        END
      END
      ELSE BEGIN
        IF T_TYPCMD = "S" &
           AND &
           PBCQTECMDFINSCT OF PDPROD_BON_CMD <> 0 &
           AND &
           PBCQTERCUFINSCT OF PDPROD_BON_CMD <> 0
        THEN BEGIN
          LET T_TYPCMD = "M"
        END
        ELSE BEGIN
          IF T_TYPCMD = "F" &
             AND &
             PBCQTECMDDBTSCT OF PDPROD_BON_CMD <> 0 &
             AND &
             PBCQTERCUDBTSCT OF PDPROD_BON_CMD <> 0
          THEN BEGIN
            LET T_TYPCMD = "M"
          END
        END
      END
    END
  END

  LET PBCTYP OF PDPROD_BON_CMD = T_TYPCMD


  ;
  ; Si l'enregistrement a été modifié
  ;
  IF T_ALTREC = "1"
  THEN BEGIN
    GET PDDET_BON_COMMAN OPTIONAL &
      VIA  CIECLE,    &
           BCMNUMBCM, &
           DIANUM002, &
           PRICODPRI  &
      USING T_CIECLEMNU,                 &
            BCMNUMBCM OF PDBON_COMMANDE, &
            DIANUM002 OF PDPROD_BON_CMD, &
            PRICODPRI OF PDPROD_BON_CMD
    IF ACCESSOK
    THEN BEGIN
      LET PODSURDBTCMD OF PDBON_COMMANDE = PODSURDBTCMD OF PDBON_COMMANDE + &
                                               (DIASURMC2        OF PDDIAGRAMME * &
                                                   PBCQTECMDDBTSCT  OF PDPROD_BON_CMD)

      LET PODSURFINCMD OF PDBON_COMMANDE = PODSURFINCMD OF PDBON_COMMANDE + &
                                               (DIASURMC2        OF PDDIAGRAMME * &
                                                   PBCQTECMDFINSCT  OF PDPROD_BON_CMD)

      IF PBCQTECMDDBTSCT  OF PDPROD_BON_CMD  > PBCQTECMDFINSCT  OF PDPROD_BON_CMD
      THEN BEGIN
        LET PODQTECMD        OF PDDET_BON_COMMAN = PBCQTECMDDBTSCT  OF PDPROD_BON_CMD
        LET PODVOLCMD        OF PDDET_BON_COMMAN = DIAVOLMC3        OF PDDIAGRAMME * &
                                                   PBCQTECMDDBTSCT  OF PDPROD_BON_CMD
      END
      ELSE BEGIN
        LET PODQTECMD        OF PDDET_BON_COMMAN = PBCQTECMDFINSCT  OF PDPROD_BON_CMD
        LET PODVOLCMD        OF PDDET_BON_COMMAN = DIAVOLMC3        OF PDDIAGRAMME * &
                                                   PBCQTECMDFINSCT  OF PDPROD_BON_CMD
      END
      PUT PDDET_BON_COMMAN RESET
    END
    ELSE BEGIN
      ERROR "Problème technique 1..."
    END
  END
END


;-------------------------------------------------------------------------------
;
; Procedure de destruction
;

PROCEDURE DELETE
BEGIN
  ;
  ; Vérifie qu'il n'y a pas eu de réception pour ce bon de commande
  ;
  GET PDRECEPTION_VER_DEL                         &
    VIA     CIECLE,                               &
            BCMNUMBCM                             &
    USING   T_CIECLEMNU,                          &
            BCMNUMBCM        OF PDBON_COMMANDE OPTIONAL
  IF NOT ACCESSOK
  THEN BEGIN
    ;
    ; Destruction du détail du P/O (on ne peut pas détruire l'entete du P/O)
    ;
    FOR PDPROD_BON_CMD
    BEGIN
      ;
      ; Recherche detail bon de commande
      ;
      GET PDDET_BON_COMMAN OPTIONAL    &
        VIA   CIECLE,          &
              BCMNUMBCM,       &
              DIANUM002,       &
              PRICODPRI        &
        USING T_CIECLEMNU,                        &
              BCMNUMBCM        OF PDBON_COMMANDE, &
              DIANUM002        OF PDPROD_BON_CMD, &
              PRICODPRI        OF PDPROD_BON_CMD
      ;
      ; Si retrouver alors on de détruit détail de bon de commande
      ;
      LET PODSURDBTCMD OF PDBON_COMMANDE = 0
      LET PODSURFINCMD OF PDBON_COMMANDE = 0

      IF ACCESSOK
      THEN BEGIN
        DELETE PDDET_BON_COMMAN
      END
;    END
;      LET PDGQTEPLACPEGRA OF PDPRIORITE_DIAG = PDGQTEPLACPEGRA OF PDPRIORITE_DIAG + PBCQTECMDDBTSCT OF PDPROD_BON_CMD
;      LET PDGQTEPLAFINGRA OF PDPRIORITE_DIAG = PDGQTEPLAFINGRA OF PDPRIORITE_DIAG + PBCQTECMDFINSCT OF PDPROD_BON_CMD
;      LET PDGQTEPLACPESCT OF PDPRIORITE_DIAG = PDGQTEPLACPESCT OF PDPRIORITE_DIAG - PBCQTECMDDBTSCT OF PDPROD_BON_CMD
;      LET PDGQTEPLAFINSCT OF PDPRIORITE_DIAG = PDGQTEPLAFINSCT OF PDPRIORITE_DIAG - PBCQTECMDFINSCT OF PDPROD_BON_CMD

;-a verifier
     ; LET PDGQTEPLACPEGRA OF PDPRIORITE_DIAG = PDGQTEPLACPEGRA OF PDPRIORITE_DIAG + PDGQTEPLACPESCT OF PDPRIORITE_DIAG
     ; LET PDGQTEPLAFINGRA OF PDPRIORITE_DIAG = PDGQTEPLAFINGRA OF PDPRIORITE_DIAG + PDGQTEPLAFINSCT OF PDPRIORITE_DIAG
     ; LET PDGQTEPLACPESCT OF PDPRIORITE_DIAG = PDGQTEPLACPESCT OF PDPRIORITE_DIAG - PDGQTEPLACPEGRA OF PDPRIORITE_DIAG
     ; LET PDGQTEPLAFINSCT OF PDPRIORITE_DIAG = PDGQTEPLAFINSCT OF PDPRIORITE_DIAG - PDGQTEPLAFINGRA OF PDPRIORITE_DIAG
    ;
    ; Destruction du détail du P/O
    ;
   END
    DELETE PDPROD_BON_CMD
  END
;  ELSE IF ACCESSOK  ;---on peut deleter si la qte est a 0
;   THEN BEGIN
;    IF PBCQTERCUFINSCT OF PDPROD_BON_CMD = 0
;    THEN BEGIN
    ;
    ; Destruction du détail du P/O (on ne peut pas détruire l'entete du P/O)
    ;
;    FOR PDPROD_BON_CMD
;    BEGIN
      ;
      ; Recherche detail bon de commande
      ;
;      GET PDDET_BON_COMMAN OPTIONAL    &
;        VIA   CIECLE,          &
;              BCMNUMBCM,       &
;              DIANUM002,       &
;              PRICODPRI        &
;        USING T_CIECLEMNU,                        &
;              BCMNUMBCM        OF PDBON_COMMANDE, &
;              DIANUM002        OF PDPROD_BON_CMD, &
;              PRICODPRI        OF PDPROD_BON_CMD
      ;
      ; Si retrouver alors on de détruit détail de bon de commande
      ;
;      LET PODSURDBTCMD OF PDBON_COMMANDE = 0
;      LET PODSURFINCMD OF PDBON_COMMANDE = 0

;      IF ACCESSOK
;      THEN BEGIN
;        DELETE PDDET_BON_COMMAN
;      END
    ;END
  ;      LET PDGQTEPLACPEGRA OF PDPRIORITE_DIAG = PDGQTEPLACPEGRA OF PDPRIORITE_DIAG + PDGQTEPLACPESCT OF PDPRIORITE_DIAG
  ;    LET PDGQTEPLAFINGRA OF PDPRIORITE_DIAG = PDGQTEPLAFINGRA OF PDPRIORITE_DIAG + PDGQTEPLAFINSCT OF PDPRIORITE_DIAG
   ;   LET PDGQTEPLACPESCT OF PDPRIORITE_DIAG = PDGQTEPLACPESCT OF PDPRIORITE_DIAG - PDGQTEPLACPEGRA OF PDPRIORITE_DIAG
   ;   LET PDGQTEPLAFINSCT OF PDPRIORITE_DIAG = PDGQTEPLAFINSCT OF PDPRIORITE_DIAG - PDGQTEPLAFINGRA OF PDPRIORITE_DIAG

;      LET PDGQTEPLACPEGRA OF PDPRIORITE_DIAG = PDGQTEPLACPEGRA OF PDPRIORITE_DIAG + PBCQTECMDDBTSCT OF PDPROD_BON_CMD
;      LET PDGQTEPLAFINGRA OF PDPRIORITE_DIAG = PDGQTEPLAFINGRA OF PDPRIORITE_DIAG + PBCQTECMDFINSCT OF PDPROD_BON_CMD
;      LET PDGQTEPLACPESCT OF PDPRIORITE_DIAG = PDGQTEPLACPESCT OF PDPRIORITE_DIAG - PBCQTECMDDBTSCT OF PDPROD_BON_CMD
;      LET PDGQTEPLAFINSCT OF PDPRIORITE_DIAG = PDGQTEPLAFINSCT OF PDPRIORITE_DIAG - PBCQTECMDFINSCT OF PDPROD_BON_CMD
;    END
    ;
    ; Destruction du détail du P/O
    ;
;    DELETE PDPROD_BON_CMD
;   END
;  END
END

;-----------------------------------------------------------------
PROCEDURE APPEND
  BEGIN
    ACCEPT DIANUM002 OF PDPROD_BON_CMD
    ACCEPT PRICODPRI OF PDPROD_BON_CMD
    ACCEPT PBCQTECMDDBTSCT OF PDPROD_BON_CMD
    DISPLAY PBCQTERCUDBTSCT OF PDPROD_BON_CMD
    ACCEPT PBCQTECMDFINSCT OF PDPROD_BON_CMD
    DISPLAY PBCQTERCUFINSCT OF PDPROD_BON_CMD
    END
PROCEDURE ENTRY
  BEGIN
    FOR PDPROD_BON_CMD
      BEGIN
        PERFORM APPEND
        END
    END
PROCEDURE PATH
  BEGIN
    LET PATH = 1
    END
PROCEDURE FIND
  BEGIN
    FOR MISSING PDPROD_BON_CMD
      BEGIN
        GET PDPROD_BON_CMD VIA CIECLE , BCMNUMBCM ORDERBY CIECLE , &
              PJTNUMPRO , DIANUM002 , PRICODPRI USING T_CIECLEMNU , &
              BCMNUMBCM OF PDBON_COMMANDE
        LET T_PBCQTECMDDBTSCT = PBCQTECMDDBTSCT OF PDPROD_BON_CMD
        LET T_PBCQTECMDFINSCT = PBCQTECMDDBTSCT OF PDPROD_BON_CMD
        GET PDPRIORITE_DIAG OPTIONAL
        END
    END
PROCEDURE UPDATE
  BEGIN
    PUT PDBON_COMMANDE
    FOR PDPROD_BON_CMD
      BEGIN
        PUT PDPROD_BON_CMD
        PUT PDPRIORITE_DIAG
        END
    END



;-----------------------------------------------------------------------
PROCEDURE INTERNAL A_PRIO
BEGIN
 ;
 ;VERIFICATION DES PRIO COMMAN_INTERNE
 ;
 WHILE RETRIEVING A_PDPRIORITE_DIAG &
      VIA   CIECLE,                &
            DIANUM002              &
      USING T_CIECLE,           &
            DIANUM002 OF A_PDPROD_BON_CMD
 BEGIN


  GET PDPRIORITE   OPT         &
          VIA   CIECLE,                    &
                PJTABR,                    &
                PJTANN,                    &
                COMNUMCOMINT,              &
                PRICODPRI                  &
          USING T_CIECLE,                          &
                PJTABR           OF        A_PDPRIORITE_DIAG, &
                PJTANN           OF             A_PDPRIORITE_DIAG, &
                COMNUMCOMINT     OF                    A_PDPRIORITE_DIAG,&
                PRICODPRI        OF A_PDPRIORITE_DIAG
  IF NOT ACCESSOK
   THEN ERROR = "MAUVAISE PRIORITE VS COMMANDE INTERNE"
 END
END

;-----------------------------------------------------------------------
PROCEDURE INTERNAL TRAV
BEGIN
;
;UNITE DE TRAVAIL
;
WHILE RETRIEVING PDUNI_TRAV_DIA &
         VIA     CIECLE,          &
                 DIANUM002        &
         USING   T_CIECLEMNU,                         &
                 DIANUM002        OF A_pddiagramme
BEGIN
 GET A_PDUNI_TRAV_DIA  OPT &
         VIA     CIECLE,          &
                 DIANUM002,       &
                 UTRNUMUNITRV     &
         USING   T_CIECLE,                         &
                 DIANUM002           OF A_PDDIAGRAMME, &
                 UTRNUMUNITRV        OF PDUNI_TRAV_DIA
 IF ACCESSOK
  THEN NULL ;info   = "UNITE EXISTANTE..." + dianum002 of a_pddiagramme +"  " +UTRNUMUNITRV OF PDUNI_TRAV_DIA now resp
 ELSE BEGIN
  LET CIECLE           OF A_PDUNI_TRAV_DIA = T_CIECLE
  LET DIANUM002        OF A_PDUNI_TRAV_DIA = DIANUM002    OF PDUNI_TRAV_DIA
  LET UTRNUMUNITRV     OF A_PDUNI_TRAV_DIA = UTRNUMUNITRV OF PDUNI_TRAV_DIA
  LET UTDQTEPRD        OF A_PDUNI_TRAV_DIA = UTDQTEPRD    OF PDUNI_TRAV_DIA
  LET UTDUNMPRD        OF A_PDUNI_TRAV_DIA = UTDUNMPRD    OF PDUNI_TRAV_DIA
  LET UTDQTEPRI        OF A_PDUNI_TRAV_DIA = UTDQTEPRI    OF PDUNI_TRAV_DIA
  LET UTDUNMVEN        OF A_PDUNI_TRAV_DIA = UTDUNMVEN    OF PDUNI_TRAV_DIA
  LET UTDQTEUTRCMD     OF A_PDUNI_TRAV_DIA = UTDQTEUTRCMD OF PDUNI_TRAV_DIA
  LET UTDQTEUTRPRD     OF A_PDUNI_TRAV_DIA = UTDQTEUTRPRD OF PDUNI_TRAV_DIA
  LET UTDQTECMD        OF A_PDUNI_TRAV_DIA = UTDQTECMD    OF PDUNI_TRAV_DIA
  LET UTDUNMCMD        OF A_PDUNI_TRAV_DIA = UTDUNMCMD    OF PDUNI_TRAV_DIA
  LET PJTABR           OF A_PDUNI_TRAV_DIA = PJTABR       OF PDUNI_TRAV_DIA
  LET DIANUMDIA002     OF A_PDUNI_TRAV_DIA = DIANUMDIA002 OF PDUNI_TRAV_DIA
  LET PJTANN           OF A_PDUNI_TRAV_DIA = PJTANN       OF PDUNI_TRAV_DIA
  LET COMNUMCOMINT     OF A_PDUNI_TRAV_DIA = COMNUMCOMINT OF PDUNI_TRAV_DIA
  LET COMNUMCOM        OF A_PDUNI_TRAV_DIA = COMNUMCOM    OF PDUNI_TRAV_DIA
  LET PJTNUMSEQ        OF A_PDUNI_TRAV_DIA = PJTNUMSEQ    OF PDUNI_TRAV_DIA
  LET PJTNUMPRO        OF A_PDUNI_TRAV_DIA = PJTNUMPRO    OF PDUNI_TRAV_DIA
 PUT A_PDUNI_TRAV_DIA RESET
 END
END

END
;----------------------------------------------------------------------
PROCEDURE INTERNAL B_PRIO
BEGIN

     WHILE RETRIEVING B_PDPRIORITE_DIAG    &
      VIA   CIECLE,                &
            DIANUM002              &
      USING T_CIECLEMNU,           &
            DIANUM002 OF A_PDPROD_BON_CMD

        BEGIN

        GET A_PDPRIORITE_DIAG OPTIONAL   &
              VIA   CIECLE,                &
                    PRICODPRI,             &
                    DIANUM002              &
              USING T_CIECLE,           &
                    PRICODPRI OF B_PDPRIORITE_DIAG,             &
                    DIANUM002 OF A_PDPROD_BON_CMD
        IF NOT ACCESSOK
        THEN BEGIN

          LET CIECLE           OF A_PDPRIORITE_DIAG = T_CIECLE
          LET PRICODPRI        OF A_PDPRIORITE_DIAG = PRICODPRI OF B_PDPRIORITE_DIAG
          LET PJTABR           OF A_PDPRIORITE_DIAG = PJTABR    OF B_PDPRIORITE_DIAG
          LET DIANUMDIA002     OF A_PDPRIORITE_DIAG = DIANUMDIA002 OF B_PDPRIORITE_DIAG
          LET DIANUM002        OF A_PDPRIORITE_DIAG = DIANUM002    OF B_PDPRIORITE_DIAG

          LET PDGQTEPLACPEGRA  OF A_PDPRIORITE_DIAG = PDGQTEPLACPESCT OF B_PDPRIORITE_DIAG
          LET PDGQTEPLACPEUSC  OF A_PDPRIORITE_DIAG = 0
          LET PDGQTEPLACPESCT  OF A_PDPRIORITE_DIAG =  0;PDGQTEPLACPESCT  OF A_PDPRIORITE_DIAG -  PDGQTEPLACPESCT OF B_PDPRIORITE_DIAG

          LET PDGQTEPLAFINGRA  OF A_PDPRIORITE_DIAG = PDGQTEPLAFINSCT OF B_PDPRIORITE_DIAG
          LET PDGQTEPLAFINSCT  OF A_PDPRIORITE_DIAG = 0 ;PDGQTEPLAFINSCT  OF A_PDPRIORITE_DIAG - PDGQTEPLAFINSCT OF B_PDPRIORITE_DIAG
          LET PDGQTEPLAFINUSC  OF A_PDPRIORITE_DIAG = 0

          LET PDGQTECPEPRDGRA OF A_PDPRIORITE_DIAG = 0
          LET PDGQTECPERCUSCT OF A_PDPRIORITE_DIAG = 0
          LET PDGQTECPERCUUSC OF A_PDPRIORITE_DIAG = 0

          LET PDGQTEFINPRDGRA OF A_PDPRIORITE_DIAG = 0
          LET PDGQTEFINRCUSCT OF A_PDPRIORITE_DIAG = 0
          LET PDGQTEFINRCUUSC OF A_PDPRIORITE_DIAG = 0



          LET PDGSTU           OF A_PDPRIORITE_DIAG = PDGSTU          OF B_PDPRIORITE_DIAG
          LET DCINUMLIG        OF A_PDPRIORITE_DIAG = DCINUMLIG    OF B_PDPRIORITE_DIAG
          LET PJTANN           OF A_PDPRIORITE_DIAG = PJTANN       OF B_PDPRIORITE_DIAG
          LET COMNUMCOMINT     OF A_PDPRIORITE_DIAG = COMNUMCOMINT OF B_PDPRIORITE_DIAG
          LET COMNUMCOM        OF A_PDPRIORITE_DIAG = COMNUMCOM    OF B_PDPRIORITE_DIAG
          LET PJTNUMSEQ        OF A_PDPRIORITE_DIAG = PJTNUMSEQ    OF B_PDPRIORITE_DIAG
          LET PJTNUMPRO        OF A_PDPRIORITE_DIAG = PJTNUMPRO    OF B_PDPRIORITE_DIAG


        PUT A_PDPRIORITE_DIAG ;RESET

;           put A_pddiagramme ;RESET

  END
 END
END
;-----------------------------------------------------------------------
PROCEDURE INTERNAL QTE_PROD_BON_CMD
BEGIN
 LET T_2PBCQTECMDDBTSCT = 0
 LET T_2PBCQTECMDFINSCT = 0

    WHILE RETRIEVING X_PDprod_bon_cmd &
      VIA   CIECLE,                            &
            DIANUM002,                         &
            BCMNUMBCM                          &
      USING T_CIECLEMNU,                       &
            DIANUM002        OF B_PDDIAGRAMME, &
            BCMNUMBCM        OF PDBON_COMMANDE
     BEGIN
          LET T_2PBCQTECMDDBTSCT = T_2PBCQTECMDDBTSCT + PBCQTECMDDBTSCT OF X_PDPROD_BON_CMD
          LET T_2PBCQTECMDFINSCT = T_2PBCQTECMDFINSCT + PBCQTECMDFINSCT OF X_PDPROD_BON_CMD
     END
END
;-------------------------------------------------
PROCEDURE INTERNAL VALIDE_LIGNE
BEGIN
 GET PDDETAIL_C_I OPT &
  VIA    CIECLE   ,&
         COMNUMCOM,&
         DCINUMLIG &
  USING  T_CIECLE ,&
         COMNUMCOM OF PDCOMMAN_INTERNE,&
         DCINUMLIG OF B_PDDIAGRAMME
 IF ACCESSOK
 THEN NULL
 ELSE
  ERROR = "Cette ligne de commande n'existe pas " + DCINUMLIG OF B_PDDIAGRAMME
END
;----------------------------------------------
PROCEDURE INTERNAL A_DIAG
BEGIN

 ; WHILE RETRIEVING B_pddiagramme  &
 ;       via   ciecle,&
 ;             dianum002 &
 ;       using t_cieclemnu,&
 ;             dianum002 of pdprod_bon_cmd
 ;  begin
  GET B_pddiagramme OPT &
        via   ciecle,&
              dianum002 &
        using t_cieclemnu,&
              dianum002 of a_pdprod_bon_cmd
   IF ACCESSOK
   THEN begin

          get pdcomman_interne opt &
             via   ciecle, &
                   comnumcom &
            using t_ciecle,&
                   comnumcom of B_pddiagramme
          if accessok
          then begin

           get a_pddiagramme opt &
              via   ciecle,&
                    dianum002 &
              using t_ciecle,&
                    dianum002 of B_PDDIAGRAMME
           if accessok
           then NULL;info = "Ce diagramme existe!!!" + dianum002 of a_pddiagramme now resp
           else begin

             DO INTERNAL VALIDE_LIGNE

                LET CIECLE           OF A_PDDIAGRAMME = T_CIECLE
                LET PJTABR           OF A_PDDIAGRAMME = PJTABR           OF B_PDDIAGRAMME
                LET PJTANN           OF A_PDDIAGRAMME = PJTANN           OF B_PDDIAGRAMME
                LET COMNUMCOMINT     OF A_PDDIAGRAMME =COMNUMCOMINT     OF B_PDDIAGRAMME
                LET DCINUMLIG        OF A_PDDIAGRAMME =DCINUMLIG        OF B_PDDIAGRAMME
                LET TGRCODGRA        OF A_PDDIAGRAMME =TGRCODGRA        OF B_PDDIAGRAMME
                LET TYFCODFIN        OF A_PDDIAGRAMME =TYFCODFIN        OF B_PDDIAGRAMME
                LET DIANUM002        OF A_PDDIAGRAMME =DIANUM002        OF B_PDDIAGRAMME
                LET DIANUMPIECLI     OF A_PDDIAGRAMME =DIANUMPIECLI     OF B_PDDIAGRAMME
                LET DIALON           OF A_PDDIAGRAMME =DIALON           OF B_PDDIAGRAMME
                LET DIAHAU           OF A_PDDIAGRAMME=DIAHAU           OF B_PDDIAGRAMME

                DO INTERNAL QTE_PROD_BON_CMD

                IF T_2PBCQTECMDDBTSCT >= T_2PBCQTECMDFINSCT
                  THEN LET DIAQTECMD        OF A_PDDIAGRAMME = T_2PBCQTECMDDBTSCT
                  ELSE LET DIAQTECMD        OF A_PDDIAGRAMME = T_2PBCQTECMDFINSCT
                LET DIAQTEEMB        OF A_PDDIAGRAMME= 0 ;DIAQTEEMB        OF B_PDDIAGRAMME
                LET DIAQTEEXPCLI     OF A_PDDIAGRAMME= 0 ;DIAQTEEXPCLI     OF B_PDDIAGRAMME
               LET DIAQTEREJ        OF A_PDDIAGRAMME= 0 ;DIAQTEREJ        OF B_PDDIAGRAMME
                LET DIAQTEREM        OF A_PDDIAGRAMME= 0 ;DIAQTEREM        OF B_PDDIAGRAMME
                LET DIAFLGPRXPIE     OF A_PDDIAGRAMME= DIAFLGPRXPIE     OF B_PDDIAGRAMME
                LET DIAMNTPRXPIE     OF A_PDDIAGRAMME= 0 ;DIAMNTPRXPIE     OF B_PDDIAGRAMME
                LET DIASTU           OF A_PDDIAGRAMME=DIASTU           OF B_PDDIAGRAMME
         ;       LET DIAQTEPLADBTGRA  OF A_PDDIAGRAMME=PBCQTECMDDBTSCT OF PDPROD_BON_CMD
         ;       LET DIAQTEPLADBTUSC  OF A_PDDIAGRAMME= 0 ;DIAQTEPLADBTUSC  OF B_PDDIAGRAMME
         ;        LET DIAQTEPLADBTSCT  OF A_PDDIAGRAMME= 0 ;DIAQTEPLADBTSCT  OF B_PDDIAGRAMME
        ;        LET DIAQTEDBTGRA     OF A_PDDIAGRAMME= 0 ;DIAQTEDBTGRA     OF B_PDDIAGRAMME
        ;        LET DIAQTEDBTUSC     OF A_PDDIAGRAMME= 0 ;DIAQTEDBTUSC     OF B_PDDIAGRAMME
        ;        LET DIAQTEDBTSCT     OF A_PDDIAGRAMME= 0 ;DIAQTEDBTSCT     OF B_PDDIAGRAMME
                LET DIAQTEPREUSC     OF A_PDDIAGRAMME= 0;DIAQTEPREUSC     OF B_PDDIAGRAMME
                LET DIAQTEEXPUSISCD  OF A_PDDIAGRAMME= 0;DIAQTEEXPUSISCD  OF B_PDDIAGRAMME
                LET DIATYPDIA        OF A_PDDIAGRAMME=DIATYPDIA        OF B_PDDIAGRAMME
       ;         LET DIAQTEPLAFINGRA  OF A_PDDIAGRAMME=PBCQTECMDFINSCT OF PDPROD_BON_CMD
       ;         LET DIAQTEPLAFINUSC  OF A_PDDIAGRAMME=0;DIAQTEPLAFINUSC  OF B_PDDIAGRAMME
   ;             LET DIAQTEPLAFINSCT  OF A_PDDIAGRAMME=0;DIAQTEPLAFINSCT  OF B_PDDIAGRAMME
      ;          LET DIAQTEFINGRA     OF A_PDDIAGRAMME=0;DIAQTEFINGRA     OF B_PDDIAGRAMME
      ;          LET DIAQTEFINUSC     OF A_PDDIAGRAMME=0;DIAQTEFINUSC     OF B_PDDIAGRAMME
      ;          LET DIAQTEFINSCT     OF A_PDDIAGRAMME=0;DIAQTEFINSCT     OF B_PDDIAGRAMME
                LET DIAQTEPRESCT     OF A_PDDIAGRAMME=0;DIAQTEPRESCT     OF B_PDDIAGRAMME
                LET DIAQTEEXPSCT     OF A_PDDIAGRAMME=0;DIAQTEEXPSCT     OF B_PDDIAGRAMME
                LET DIACOM001        OF A_PDDIAGRAMME=DIACOM001        OF B_PDDIAGRAMME
                LET DIADATCRE        OF A_PDDIAGRAMME=SYSDATE
                LET DIAHRECRE        OF A_PDDIAGRAMME= SYSTIME
                LET DIAUSRCRE        OF A_PDDIAGRAMME= LOGONID
                LET DIANUMDIA001     OF A_PDDIAGRAMME=DIANUMDIA001  OF B_PDDIAGRAMME
                LET DIANUMDIA002     OF A_PDDIAGRAMME=DIANUMDIA002 OF B_PDDIAGRAMME
                LET DIAEPA           OF A_PDDIAGRAMME=DIAEPA OF B_PDDIAGRAMME
                LET DIAPRIFAC        OF A_PDDIAGRAMME=0;DIAPRIFAC OF B_PDDIAGRAMME
                LET DIACOM002        OF A_PDDIAGRAMME=DIACOM002 OF B_PDDIAGRAMME
                LET DIANUM001        OF A_PDDIAGRAMME=DIANUM001 OF B_PDDIAGRAMME
                LET DIAVOLMC3        OF A_PDDIAGRAMME=DIAVOLMC3 OF B_PDDIAGRAMME
                LET DIASURMC2        OF A_PDDIAGRAMME=DIASURMC2 OF B_PDDIAGRAMME
                LET DIAQTEREMAC      OF A_PDDIAGRAMME=0;DIAQTEREMAC OF B_PDDIAGRAMME
                LET DIAQTEREMSC      OF A_PDDIAGRAMME=0;DIAQTEREMSC OF B_PDDIAGRAMME
                LET DIAQTEFAC        OF A_PDDIAGRAMME=0;DIAQTEFAC OF B_PDDIAGRAMME
                LET DIAQTERFR        OF A_PDDIAGRAMME=0;DIAQTERFR OF B_PDDIAGRAMME
      ;          LET DIAQTEPREGRA     OF A_PDDIAGRAMME=0;DIAQTEPREGRA OF B_PDDIAGRAMME
                LET COMNUMCOM        OF A_PDDIAGRAMME=COMNUMCOM OF B_PDDIAGRAMME
                LET PJTNUMPRO        OF A_PDDIAGRAMME=PJTNUMPRO OF B_PDDIAGRAMME
          ;      LET DIAQTEDBT        OF A_PDDIAGRAMME=0;DIAQTEDBT OF B_PDDIAGRAMME
     ;           LET DIAQTEPLAFIN     OF A_PDDIAGRAMME=0;DIAQTEPLAFIN OF B_PDDIAGRAMME
    ;            LET DIAQTEFIN        OF A_PDDIAGRAMME=0;DIAQTEFIN OF B_PDDIAGRAMME
            do internal trav
           put A_pddiagramme RESET
           end
          end
          else error = "La commande n'est pas cree"
       END
END
;-------------------------------------------------
PROCEDURE designer d001
BEGIN
    LET T_CIECLE = "@"
    RUN SCREEN mc106 PASSING T_CIECLE MODE F

    WHILE RETRIEVING A_PDprod_bon_cmd &
      VIA   CIECLE,                            &
            BCMNUMBCM                          &
      USING T_CIECLEMNU,                       &
            BCMNUMBCM        OF PDBON_COMMANDE
      BEGIN
       DO INTERNAL A_DIAG
       DO INTERNAL B_PRIO
       DO INTERNAL A_PRIO
;       DO INTERNAL TRAV

 END


END

BUILD

@IF FORMAT
@ENDIF
