;/T/ Procédure de renumérotation.
;
;/P/ Programmeur..: Alain Côté
;    Date Création: 18 mars 1992
;
;/V3.02.00/ Alain Côté, 6 avril 1994, 199
;
;    Description..: Ce sous-écran est appellé par l'écran des états financier
;                   pour rénuméroter les lignes de l'état financier.
;

;/V/ Écran vérifier pour le passage à l'an 2000

;
SCREEN gl011c NOMODE ACTION LABEL " " &
              FROM 23,70 TO 23,80 &
@IF UNIX
              TRANSACTION MODE  DUAL &
@ENDIF
              RECEIVING T_EFICIECLE, T_EFICLE

TEMPORARY T_EFICIECLE CHARACTER SIZE 4 ; Compagnie de l'état financier
TEMPORARY T_EFICLE    CHARACTER SIZE 4 ; Clée de l'état financier

;
; Fichier à rénuméroter.
;
FILE GLEFI_DETAIL     DESIGNER
  ACCESS  VIA     EFICIECLE , &
                  EFICLE      &
          USING   T_EFICIECLE, &
                  T_EFICLE     &
          ORDERBY EFICIECLE , &
                  EFICLE    , &
                  EFDNUMLIG

;
; Pour avoir la correspondance de l'ancien et du nouveau numéro de ligne
;
FILE GLEFI_DETAIL     DESIGNER &
                      OPEN READ &
                      ALIAS A_EFD_NUMERO

;-------------------------------------------------------------------------------

TEMP T_COMPTEUR  INT SIZE 4
TEMP T_INCREMENT INT SIZE 2


PROCEDURE ENTRY
BEGIN
  ;
  ; On compte le nombre d'enregistrements
  ;
  LET T_COMPTEUR = 0
  LET T_INCREMENT = 0
  WHILE RETRIEVING GLEFI_DETAIL
  BEGIN
    LET T_COMPTEUR = T_COMPTEUR + 1
  END
  ;
  ; On determine l'increment
  ;
  IF T_COMPTEUR < 1000
  THEN BEGIN
     LET T_INCREMENT = 100
  END
  ELSE BEGIN
    IF T_COMPTEUR < 2000
    THEN LET T_INCREMENT = 50
    ELSE LET T_INCREMENT = 10
  END
  ;
  ; Inscrit le nouveau numéro ligne pour chaque record.
  ;
  LET T_COMPTEUR = 0
  WHILE RETRIEVING GLEFI_DETAIL
  BEGIN
    LET T_COMPTEUR = T_COMPTEUR + T_INCREMENT
    LET EFDNUMLIGTMP OF GLEFI_DETAIL = T_COMPTEUR
    PUT GLEFI_DETAIL
  END
  ;
  ; Renumérotation des colonnes de ratios.
  ;
  WHILE RETRIEVING GLEFI_DETAIL
  BEGIN
    IF EFDRATB OF GLEFI_DETAIL <> 0
    THEN BEGIN
      GET A_EFD_NUMERO VIA   EFICIECLE , &
                             EFICLE    , &
                             EFDNUMLIG   &
                       USING EFICIECLE OF GLEFI_DETAIL , &
                             EFICLE    OF GLEFI_DETAIL , &
                             EFDRATB   OF GLEFI_DETAIL   &
                       OPTIONAL
      LET EFDRATB OF GLEFI_DETAIL = EFDNUMLIGTMP OF A_EFD_NUMERO
    END
    IF EFDRATC OF GLEFI_DETAIL <> 0
    THEN BEGIN
      GET A_EFD_NUMERO VIA   EFICIECLE , &
                             EFICLE    , &
                             EFDNUMLIG   &
                       USING EFICIECLE OF GLEFI_DETAIL , &
                             EFICLE    OF GLEFI_DETAIL , &
                             EFDRATC   OF GLEFI_DETAIL   &
                       OPTIONAL
      LET EFDRATC OF GLEFI_DETAIL = EFDNUMLIGTMP OF A_EFD_NUMERO
    END
    IF EFDRATD OF GLEFI_DETAIL <> 0
    THEN BEGIN
      GET A_EFD_NUMERO VIA   EFICIECLE , &
                             EFICLE    , &
                             EFDNUMLIG   &
                       USING EFICIECLE OF GLEFI_DETAIL , &
                             EFICLE    OF GLEFI_DETAIL , &
                             EFDRATD   OF GLEFI_DETAIL   &
                       OPTIONAL
      LET EFDRATD OF GLEFI_DETAIL = EFDNUMLIGTMP OF A_EFD_NUMERO
    END
    IF EFDRATE OF GLEFI_DETAIL <> 0
    THEN BEGIN
      GET A_EFD_NUMERO VIA   EFICIECLE , &
                             EFICLE    , &
                             EFDNUMLIG   &
                       USING EFICIECLE OF GLEFI_DETAIL , &
                             EFICLE    OF GLEFI_DETAIL , &
                             EFDRATE   OF GLEFI_DETAIL   &
                       OPTIONAL
      LET EFDRATE OF GLEFI_DETAIL = EFDNUMLIGTMP OF A_EFD_NUMERO
    END
    IF EFDRATF OF GLEFI_DETAIL <> 0
    THEN BEGIN
      GET A_EFD_NUMERO VIA   EFICIECLE , &
                             EFICLE    , &
                             EFDNUMLIG   &
                       USING EFICIECLE OF GLEFI_DETAIL , &
                             EFICLE    OF GLEFI_DETAIL , &
                             EFDRATF   OF GLEFI_DETAIL   &
                       OPTIONAL
      LET EFDRATF OF GLEFI_DETAIL = EFDNUMLIGTMP OF A_EFD_NUMERO
    END
    IF EFDRATG OF GLEFI_DETAIL <> 0
    THEN BEGIN
      GET A_EFD_NUMERO VIA   EFICIECLE , &
                             EFICLE    , &
                             EFDNUMLIG   &
                       USING EFICIECLE OF GLEFI_DETAIL , &
                             EFICLE    OF GLEFI_DETAIL , &
                             EFDRATG   OF GLEFI_DETAIL   &
                       OPTIONAL
      LET EFDRATG OF GLEFI_DETAIL = EFDNUMLIGTMP OF A_EFD_NUMERO
    END
    IF EFDRATH OF GLEFI_DETAIL <> 0
    THEN BEGIN
      GET A_EFD_NUMERO VIA   EFICIECLE , &
                             EFICLE    , &
                             EFDNUMLIG   &
                       USING EFICIECLE OF GLEFI_DETAIL , &
                             EFICLE    OF GLEFI_DETAIL , &
                             EFDRATH   OF GLEFI_DETAIL   &
                       OPTIONAL
      LET EFDRATH OF GLEFI_DETAIL = EFDNUMLIGTMP OF A_EFD_NUMERO
    END
    IF EFDRATI OF GLEFI_DETAIL <> 0
    THEN BEGIN
      GET A_EFD_NUMERO VIA   EFICIECLE , &
                             EFICLE    , &
                             EFDNUMLIG   &
                       USING EFICIECLE OF GLEFI_DETAIL , &
                             EFICLE    OF GLEFI_DETAIL , &
                             EFDRATI   OF GLEFI_DETAIL   &
                       OPTIONAL
      LET EFDRATI OF GLEFI_DETAIL = EFDNUMLIGTMP OF A_EFD_NUMERO
    END
    IF EFDRATJ OF GLEFI_DETAIL <> 0
    THEN BEGIN
      GET A_EFD_NUMERO VIA   EFICIECLE , &
                             EFICLE    , &
                             EFDNUMLIG   &
                       USING EFICIECLE OF GLEFI_DETAIL , &
                             EFICLE    OF GLEFI_DETAIL , &
                             EFDRATJ   OF GLEFI_DETAIL   &
                       OPTIONAL
      LET EFDRATJ OF GLEFI_DETAIL = EFDNUMLIGTMP OF A_EFD_NUMERO
    END
    IF EFDRATK OF GLEFI_DETAIL <> 0
    THEN BEGIN
      GET A_EFD_NUMERO VIA   EFICIECLE , &
                             EFICLE    , &
                             EFDNUMLIG   &
                       USING EFICIECLE OF GLEFI_DETAIL , &
                             EFICLE    OF GLEFI_DETAIL , &
                             EFDRATK   OF GLEFI_DETAIL   &
                       OPTIONAL
      LET EFDRATK OF GLEFI_DETAIL = EFDNUMLIGTMP OF A_EFD_NUMERO
    END
    IF EFDRATL OF GLEFI_DETAIL <> 0
    THEN BEGIN
      GET A_EFD_NUMERO VIA   EFICIECLE , &
                             EFICLE    , &
                             EFDNUMLIG   &
                       USING EFICIECLE OF GLEFI_DETAIL , &
                             EFICLE    OF GLEFI_DETAIL , &
                             EFDRATL   OF GLEFI_DETAIL   &
                       OPTIONAL
      LET EFDRATL OF GLEFI_DETAIL = EFDNUMLIGTMP OF A_EFD_NUMERO
    END
    IF EFDRATM OF GLEFI_DETAIL <> 0
    THEN BEGIN
      GET A_EFD_NUMERO VIA   EFICIECLE , &
                             EFICLE    , &
                             EFDNUMLIG   &
                       USING EFICIECLE OF GLEFI_DETAIL , &
                             EFICLE    OF GLEFI_DETAIL , &
                             EFDRATM   OF GLEFI_DETAIL   &
                       OPTIONAL
      LET EFDRATM OF GLEFI_DETAIL = EFDNUMLIGTMP OF A_EFD_NUMERO
    END
    IF EFDRATN OF GLEFI_DETAIL <> 0
    THEN BEGIN
      GET A_EFD_NUMERO VIA   EFICIECLE , &
                             EFICLE    , &
                             EFDNUMLIG   &
                       USING EFICIECLE OF GLEFI_DETAIL , &
                             EFICLE    OF GLEFI_DETAIL , &
                             EFDRATN   OF GLEFI_DETAIL   &
                       OPTIONAL
      LET EFDRATN OF GLEFI_DETAIL = EFDNUMLIGTMP OF A_EFD_NUMERO
    END
    IF EFDRATO OF GLEFI_DETAIL <> 0
    THEN BEGIN
      GET A_EFD_NUMERO VIA   EFICIECLE , &
                             EFICLE    , &
                             EFDNUMLIG   &
                       USING EFICIECLE OF GLEFI_DETAIL , &
                             EFICLE    OF GLEFI_DETAIL , &
                             EFDRATO   OF GLEFI_DETAIL   &
                       OPTIONAL
      LET EFDRATO OF GLEFI_DETAIL = EFDNUMLIGTMP OF A_EFD_NUMERO
    END
    IF EFDRATP OF GLEFI_DETAIL <> 0
    THEN BEGIN
      GET A_EFD_NUMERO VIA   EFICIECLE , &
                             EFICLE    , &
                             EFDNUMLIG   &
                       USING EFICIECLE OF GLEFI_DETAIL , &
                             EFICLE    OF GLEFI_DETAIL , &
                             EFDRATP   OF GLEFI_DETAIL   &
                       OPTIONAL
      LET EFDRATP OF GLEFI_DETAIL = EFDNUMLIGTMP OF A_EFD_NUMERO
    END
    PUT GLEFI_DETAIL
  END
  ;
  ; Mise-à-jour du numéro de ligne.
  ;
  WHILE RETRIEVING GLEFI_DETAIL
  BEGIN
    LET EFDNUMLIG    OF GLEFI_DETAIL = EFDNUMLIGTMP OF GLEFI_DETAIL
    LET EFDNUMLIGTMP OF GLEFI_DETAIL = 0
    PUT GLEFI_DETAIL
  END
  RETURN
END

BUILD
@IF FORMAT

@ENDIF
